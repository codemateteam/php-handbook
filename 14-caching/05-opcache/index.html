<!doctype html><html lang=ru class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Полное руководство по подготовке к собеседованиям на PHP/Laravel разработчика"><meta name=author content="CodeMate Team"><link href=https://codemateteam.github.io/php-handbook/14-caching/05-opcache/ rel=canonical><link href=../04-http-cache/ rel=prev><link href=../../15-performance/01-caching/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>OPcache - PHP/Laravel Interview Handbook</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#145-opcache class=md-skip> Перейти к содержанию </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул"> <a href=../.. title="PHP/Laravel Interview Handbook" class="md-header__button md-logo" aria-label="PHP/Laravel Interview Handbook" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 21.5c-1.35-.85-3.8-1.5-5.5-1.5-1.65 0-3.35.3-4.75 1.05-.1.05-.15.05-.25.05-.25 0-.5-.25-.5-.5V6c.6-.45 1.25-.75 2-1 1.11-.35 2.33-.5 3.5-.5 1.95 0 4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0 2.39.15 3.5.5.75.25 1.4.55 2 1v14.6c0 .25-.25.5-.5.5-.1 0-.15 0-.25-.05-1.4-.75-3.1-1.05-4.75-1.05-1.7 0-4.15.65-5.5 1.5M12 8v11.5c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5V7c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5m1 3.5c1.11-.68 2.6-1 4.5-1 .91 0 1.76.09 2.5.28V9.23c-.87-.15-1.71-.23-2.5-.23q-2.655 0-4.5.84zm4.5.17c-1.71 0-3.21.26-4.5.79v1.69c1.11-.65 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24v-1.5c-.87-.16-1.71-.23-2.5-.23m2.5 2.9c-.87-.16-1.71-.24-2.5-.24-1.83 0-3.33.27-4.5.8v1.69c1.11-.66 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> PHP/Laravel Interview Handbook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> OPcache </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Переключить на темную тему" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Переключить на темную тему" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Переключить на светлую тему" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Переключить на светлую тему" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Поиск placeholder=Поиск autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Поиск> <a href=javascript:void(0) class="md-search__icon md-icon" title=Поделиться aria-label=Поделиться data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Очистить aria-label=Очистить tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Инициализация поиска </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/codemateteam/php-handbook title="Перейти к репозиторию" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> codemateteam/php-handbook </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Вкладки data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Главная </a> </li> <li class=md-tabs__item> <a href=../../01-php-basics/01-types/ class=md-tabs__link> PHP Основы </a> </li> <li class=md-tabs__item> <a href=../../02-oop/01-classes-objects/ class=md-tabs__link> ООП в PHP </a> </li> <li class=md-tabs__item> <a href=../../03-php-advanced/01-namespaces/ class=md-tabs__link> PHP Продвинутое </a> </li> <li class=md-tabs__item> <a href=../../04-git/01-git-basics/ class=md-tabs__link> Git </a> </li> <li class=md-tabs__item> <a href=../../05-laravel-basics/01-architecture/ class=md-tabs__link> Laravel Основы </a> </li> <li class=md-tabs__item> <a href=../../06-laravel-advanced/01-eloquent-relationships/ class=md-tabs__link> Laravel Продвинутое </a> </li> <li class=md-tabs__item> <a href=../../07-sql-databases/01-sql-basics/ class=md-tabs__link> SQL & Databases </a> </li> <li class=md-tabs__item> <a href=../../08-testing/01-unit-tests/ class=md-tabs__link> Testing </a> </li> <li class=md-tabs__item> <a href=../../09-security/01-xss/ class=md-tabs__link> Security </a> </li> <li class=md-tabs__item> <a href=../../10-api-development/01-rest-api/ class=md-tabs__link> API Development </a> </li> <li class=md-tabs__item> <a href=../../11-docker/01-docker-basics/ class=md-tabs__link> Docker </a> </li> <li class=md-tabs__item> <a href=../../12-database-advanced/01-replication/ class=md-tabs__link> Database Advanced </a> </li> <li class=md-tabs__item> <a href=../../13-database-optimization/01-normalization/ class=md-tabs__link> Database Optimization </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../01-strategies/ class=md-tabs__link> Caching </a> </li> <li class=md-tabs__item> <a href=../../15-performance/01-caching/ class=md-tabs__link> Performance </a> </li> <li class=md-tabs__item> <a href=../../16-principles/01-kiss-dry-yagni/ class=md-tabs__link> Principles </a> </li> <li class=md-tabs__item> <a href=../../17-architecture-patterns/01-mvc/ class=md-tabs__link> Architecture Patterns </a> </li> <li class=md-tabs__item> <a href=../../18-design-patterns/01-creational/ class=md-tabs__link> Design Patterns </a> </li> <li class=md-tabs__item> <a href=../../19-message-brokers/01-rabbitmq/ class=md-tabs__link> Message Brokers </a> </li> <li class=md-tabs__item> <a href=../../20-microservices/01-monolith-vs-microservices/ class=md-tabs__link> Microservices </a> </li> <li class=md-tabs__item> <a href=../../21-soft-skills/01-code-review/ class=md-tabs__link> Soft Skills </a> </li> <li class=md-tabs__item> <a href=../../22-practice/01-coding-challenges/ class=md-tabs__link> Practice </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Навигация data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="PHP/Laravel Interview Handbook" class="md-nav__button md-logo" aria-label="PHP/Laravel Interview Handbook" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 21.5c-1.35-.85-3.8-1.5-5.5-1.5-1.65 0-3.35.3-4.75 1.05-.1.05-.15.05-.25.05-.25 0-.5-.25-.5-.5V6c.6-.45 1.25-.75 2-1 1.11-.35 2.33-.5 3.5-.5 1.95 0 4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0 2.39.15 3.5.5.75.25 1.4.55 2 1v14.6c0 .25-.25.5-.5.5-.1 0-.15 0-.25-.05-1.4-.75-3.1-1.05-4.75-1.05-1.7 0-4.15.65-5.5 1.5M12 8v11.5c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5V7c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5m1 3.5c1.11-.68 2.6-1 4.5-1 .91 0 1.76.09 2.5.28V9.23c-.87-.15-1.71-.23-2.5-.23q-2.655 0-4.5.84zm4.5.17c-1.71 0-3.21.26-4.5.79v1.69c1.11-.65 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24v-1.5c-.87-.16-1.71-.23-2.5-.23m2.5 2.9c-.87-.16-1.71-.24-2.5-.24-1.83 0-3.33.27-4.5.8v1.69c1.11-.66 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24z"/></svg> </a> PHP/Laravel Interview Handbook </label> <div class=md-nav__source> <a href=https://github.com/codemateteam/php-handbook title="Перейти к репозиторию" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> codemateteam/php-handbook </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Главная </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> PHP Основы </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> PHP Основы </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-php-basics/01-types/ class=md-nav__link> <span class=md-ellipsis> Типы данных </span> </a> </li> <li class=md-nav__item> <a href=../../01-php-basics/02-variables/ class=md-nav__link> <span class=md-ellipsis> Переменные </span> </a> </li> <li class=md-nav__item> <a href=../../01-php-basics/03-operators/ class=md-nav__link> <span class=md-ellipsis> Операторы </span> </a> </li> <li class=md-nav__item> <a href=../../01-php-basics/04-control-structures/ class=md-nav__link> <span class=md-ellipsis> Управляющие конструкции </span> </a> </li> <li class=md-nav__item> <a href=../../01-php-basics/05-functions/ class=md-nav__link> <span class=md-ellipsis> Функции </span> </a> </li> <li class=md-nav__item> <a href=../../01-php-basics/06-arrays/ class=md-nav__link> <span class=md-ellipsis> Массивы </span> </a> </li> <li class=md-nav__item> <a href=../../01-php-basics/07-strings-regex/ class=md-nav__link> <span class=md-ellipsis> Строки и регулярные выражения </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> ООП в PHP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ООП в PHP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../02-oop/01-classes-objects/ class=md-nav__link> <span class=md-ellipsis> Классы и объекты </span> </a> </li> <li class=md-nav__item> <a href=../../02-oop/02-inheritance/ class=md-nav__link> <span class=md-ellipsis> Наследование </span> </a> </li> <li class=md-nav__item> <a href=../../02-oop/03-interfaces/ class=md-nav__link> <span class=md-ellipsis> Интерфейсы </span> </a> </li> <li class=md-nav__item> <a href=../../02-oop/04-abstract-classes/ class=md-nav__link> <span class=md-ellipsis> Абстрактные классы </span> </a> </li> <li class=md-nav__item> <a href=../../02-oop/05-traits/ class=md-nav__link> <span class=md-ellipsis> Трейты </span> </a> </li> <li class=md-nav__item> <a href=../../02-oop/06-magic-methods/ class=md-nav__link> <span class=md-ellipsis> Магические методы </span> </a> </li> <li class=md-nav__item> <a href=../../02-oop/07-static-binding/ class=md-nav__link> <span class=md-ellipsis> Статическое связывание </span> </a> </li> <li class=md-nav__item> <a href=../../02-oop/08-visibility/ class=md-nav__link> <span class=md-ellipsis> Область видимости </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> PHP Продвинутое </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> PHP Продвинутое </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../03-php-advanced/01-namespaces/ class=md-nav__link> <span class=md-ellipsis> Пространства имён </span> </a> </li> <li class=md-nav__item> <a href=../../03-php-advanced/02-autoloading/ class=md-nav__link> <span class=md-ellipsis> Автозагрузка (Composer, PSR-4) </span> </a> </li> <li class=md-nav__item> <a href=../../03-php-advanced/03-exceptions/ class=md-nav__link> <span class=md-ellipsis> Исключения и ошибки </span> </a> </li> <li class=md-nav__item> <a href=../../03-php-advanced/04-psr/ class=md-nav__link> <span class=md-ellipsis> PSR стандарты </span> </a> </li> <li class=md-nav__item> <a href=../../03-php-advanced/05-generators/ class=md-nav__link> <span class=md-ellipsis> Генераторы </span> </a> </li> <li class=md-nav__item> <a href=../../03-php-advanced/06-reflection/ class=md-nav__link> <span class=md-ellipsis> Рефлексия </span> </a> </li> <li class=md-nav__item> <a href=../../03-php-advanced/07-php8-features/ class=md-nav__link> <span class=md-ellipsis> Новые возможности PHP 8.x </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Git </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../04-git/01-git-basics/ class=md-nav__link> <span class=md-ellipsis> Git Basics </span> </a> </li> <li class=md-nav__item> <a href=../../04-git/02-branching-strategies/ class=md-nav__link> <span class=md-ellipsis> Branching Strategies </span> </a> </li> <li class=md-nav__item> <a href=../../04-git/03-rebase-vs-merge/ class=md-nav__link> <span class=md-ellipsis> Rebase vs Merge </span> </a> </li> <li class=md-nav__item> <a href=../../04-git/04-git-flow/ class=md-nav__link> <span class=md-ellipsis> Git Flow </span> </a> </li> <li class=md-nav__item> <a href=../../04-git/05-conflict-resolution/ class=md-nav__link> <span class=md-ellipsis> Conflict Resolution </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Laravel Основы </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Laravel Основы </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../05-laravel-basics/01-architecture/ class=md-nav__link> <span class=md-ellipsis> Архитектура Laravel </span> </a> </li> <li class=md-nav__item> <a href=../../05-laravel-basics/02-service-container/ class=md-nav__link> <span class=md-ellipsis> Service Container </span> </a> </li> <li class=md-nav__item> <a href=../../05-laravel-basics/03-service-providers/ class=md-nav__link> <span class=md-ellipsis> Service Providers </span> </a> </li> <li class=md-nav__item> <a href=../../05-laravel-basics/04-facades/ class=md-nav__link> <span class=md-ellipsis> Facades </span> </a> </li> <li class=md-nav__item> <a href=../../05-laravel-basics/05-routing/ class=md-nav__link> <span class=md-ellipsis> Маршрутизация </span> </a> </li> <li class=md-nav__item> <a href=../../05-laravel-basics/06-middleware/ class=md-nav__link> <span class=md-ellipsis> Middleware </span> </a> </li> <li class=md-nav__item> <a href=../../05-laravel-basics/07-controllers/ class=md-nav__link> <span class=md-ellipsis> Контроллеры </span> </a> </li> <li class=md-nav__item> <a href=../../05-laravel-basics/08-request-response/ class=md-nav__link> <span class=md-ellipsis> Request/Response </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Laravel Продвинутое </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Laravel Продвинутое </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../06-laravel-advanced/01-eloquent-relationships/ class=md-nav__link> <span class=md-ellipsis> Eloquent Relationships </span> </a> </li> <li class=md-nav__item> <a href=../../06-laravel-advanced/02-query-builder/ class=md-nav__link> <span class=md-ellipsis> Query Builder </span> </a> </li> <li class=md-nav__item> <a href=../../06-laravel-advanced/03-migrations-seeders/ class=md-nav__link> <span class=md-ellipsis> Миграции и Сидеры </span> </a> </li> <li class=md-nav__item> <a href=../../06-laravel-advanced/04-events-listeners/ class=md-nav__link> <span class=md-ellipsis> Events & Listeners </span> </a> </li> <li class=md-nav__item> <a href=../../06-laravel-advanced/05-jobs-queues/ class=md-nav__link> <span class=md-ellipsis> Jobs & Queues </span> </a> </li> <li class=md-nav__item> <a href=../../06-laravel-advanced/06-notifications/ class=md-nav__link> <span class=md-ellipsis> Notifications </span> </a> </li> <li class=md-nav__item> <a href=../../06-laravel-advanced/07-api-resources/ class=md-nav__link> <span class=md-ellipsis> API Resources </span> </a> </li> <li class=md-nav__item> <a href=../../06-laravel-advanced/08-validation/ class=md-nav__link> <span class=md-ellipsis> Validation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> SQL & Databases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> SQL & Databases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../07-sql-databases/01-sql-basics/ class=md-nav__link> <span class=md-ellipsis> SQL Basics </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/02-aggregate-functions/ class=md-nav__link> <span class=md-ellipsis> Aggregate Functions </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/03-indexes/ class=md-nav__link> <span class=md-ellipsis> Indexes </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/04-transactions/ class=md-nav__link> <span class=md-ellipsis> Transactions </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/05-normalization/ class=md-nav__link> <span class=md-ellipsis> Normalization </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/06-n-plus-one/ class=md-nav__link> <span class=md-ellipsis> N+1 Query Problem </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/07-query-optimization/ class=md-nav__link> <span class=md-ellipsis> Query Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/08-redis/ class=md-nav__link> <span class=md-ellipsis> Redis </span> </a> </li> <li class=md-nav__item> <a href=../../07-sql-databases/09-caching/ class=md-nav__link> <span class=md-ellipsis> Caching </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Testing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../08-testing/01-unit-tests/ class=md-nav__link> <span class=md-ellipsis> Unit Tests </span> </a> </li> <li class=md-nav__item> <a href=../../08-testing/02-feature-tests/ class=md-nav__link> <span class=md-ellipsis> Feature Tests </span> </a> </li> <li class=md-nav__item> <a href=../../08-testing/03-tdd/ class=md-nav__link> <span class=md-ellipsis> TDD </span> </a> </li> <li class=md-nav__item> <a href=../../08-testing/04-mocking-stubbing/ class=md-nav__link> <span class=md-ellipsis> Mocking & Stubbing </span> </a> </li> <li class=md-nav__item> <a href=../../08-testing/05-phpunit/ class=md-nav__link> <span class=md-ellipsis> PHPUnit </span> </a> </li> <li class=md-nav__item> <a href=../../08-testing/06-pest/ class=md-nav__link> <span class=md-ellipsis> Pest </span> </a> </li> <li class=md-nav__item> <a href=../../08-testing/07-test-coverage/ class=md-nav__link> <span class=md-ellipsis> Test Coverage </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../09-security/01-xss/ class=md-nav__link> <span class=md-ellipsis> XSS </span> </a> </li> <li class=md-nav__item> <a href=../../09-security/02-csrf/ class=md-nav__link> <span class=md-ellipsis> CSRF </span> </a> </li> <li class=md-nav__item> <a href=../../09-security/03-sql-injection/ class=md-nav__link> <span class=md-ellipsis> SQL Injection </span> </a> </li> <li class=md-nav__item> <a href=../../09-security/04-authentication/ class=md-nav__link> <span class=md-ellipsis> Authentication </span> </a> </li> <li class=md-nav__item> <a href=../../09-security/05-authorization/ class=md-nav__link> <span class=md-ellipsis> Authorization </span> </a> </li> <li class=md-nav__item> <a href=../../09-security/06-encryption/ class=md-nav__link> <span class=md-ellipsis> Encryption </span> </a> </li> <li class=md-nav__item> <a href=../../09-security/07-https-ssl/ class=md-nav__link> <span class=md-ellipsis> HTTPS & SSL </span> </a> </li> <li class=md-nav__item> <a href=../../09-security/08-owasp-top-10/ class=md-nav__link> <span class=md-ellipsis> OWASP Top 10 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> API Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> API Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../10-api-development/01-rest-api/ class=md-nav__link> <span class=md-ellipsis> REST API </span> </a> </li> <li class=md-nav__item> <a href=../../10-api-development/02-graphql/ class=md-nav__link> <span class=md-ellipsis> GraphQL </span> </a> </li> <li class=md-nav__item> <a href=../../10-api-development/03-swagger-documentation/ class=md-nav__link> <span class=md-ellipsis> Swagger Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../10-api-development/04-rate-limiting/ class=md-nav__link> <span class=md-ellipsis> Rate Limiting </span> </a> </li> <li class=md-nav__item> <a href=../../10-api-development/05-api-versioning/ class=md-nav__link> <span class=md-ellipsis> API Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../10-api-development/06-cors/ class=md-nav__link> <span class=md-ellipsis> CORS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../11-docker/01-docker-basics/ class=md-nav__link> <span class=md-ellipsis> Docker Basics </span> </a> </li> <li class=md-nav__item> <a href=../../11-docker/02-dockerfile/ class=md-nav__link> <span class=md-ellipsis> Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=../../11-docker/03-docker-compose/ class=md-nav__link> <span class=md-ellipsis> Docker Compose </span> </a> </li> <li class=md-nav__item> <a href=../../11-docker/04-ci-cd/ class=md-nav__link> <span class=md-ellipsis> CI/CD </span> </a> </li> <li class=md-nav__item> <a href=../../11-docker/05-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment Strategies </span> </a> </li> <li class=md-nav__item> <a href=../../11-docker/06-monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring & Logging </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_13> <label class=md-nav__link for=__nav_13 id=__nav_13_label tabindex=0> <span class=md-ellipsis> Database Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_13_label aria-expanded=false> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> Database Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../12-database-advanced/01-replication/ class=md-nav__link> <span class=md-ellipsis> Replication </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/02-sharding/ class=md-nav__link> <span class=md-ellipsis> Sharding </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/03-window-functions/ class=md-nav__link> <span class=md-ellipsis> Window Functions </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/04-isolation-levels/ class=md-nav__link> <span class=md-ellipsis> Isolation Levels </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/05-locks/ class=md-nav__link> <span class=md-ellipsis> Locks </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/06-jsonb/ class=md-nav__link> <span class=md-ellipsis> JSONB </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/07-materialized-views/ class=md-nav__link> <span class=md-ellipsis> Materialized Views </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/08-partitioning/ class=md-nav__link> <span class=md-ellipsis> Partitioning </span> </a> </li> <li class=md-nav__item> <a href=../../12-database-advanced/09-cursor/ class=md-nav__link> <span class=md-ellipsis> Cursor </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_14> <label class=md-nav__link for=__nav_14 id=__nav_14_label tabindex=0> <span class=md-ellipsis> Database Optimization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_14_label aria-expanded=false> <label class=md-nav__title for=__nav_14> <span class="md-nav__icon md-icon"></span> Database Optimization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../13-database-optimization/01-normalization/ class=md-nav__link> <span class=md-ellipsis> Normalization </span> </a> </li> <li class=md-nav__item> <a href=../../13-database-optimization/02-denormalization/ class=md-nav__link> <span class=md-ellipsis> Denormalization </span> </a> </li> <li class=md-nav__item> <a href=../../13-database-optimization/03-big-data/ class=md-nav__link> <span class=md-ellipsis> Big Data </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_15 checked> <label class=md-nav__link for=__nav_15 id=__nav_15_label tabindex> <span class=md-ellipsis> Caching </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_15_label aria-expanded=true> <label class=md-nav__title for=__nav_15> <span class="md-nav__icon md-icon"></span> Caching </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-strategies/ class=md-nav__link> <span class=md-ellipsis> Caching Strategies </span> </a> </li> <li class=md-nav__item> <a href=../02-redis/ class=md-nav__link> <span class=md-ellipsis> Redis </span> </a> </li> <li class=md-nav__item> <a href=../03-memcached/ class=md-nav__link> <span class=md-ellipsis> Memcached </span> </a> </li> <li class=md-nav__item> <a href=../04-http-cache/ class=md-nav__link> <span class=md-ellipsis> HTTP Cache </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> OPcache </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> OPcache </span> </a> <nav class="md-nav md-nav--secondary" aria-label=Содержание> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Содержание </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> Краткое резюме </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> Содержание </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> Что это </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> Установка и конфигурация </span> </a> </li> <li class=md-nav__item> <a href=#production-settings class=md-nav__link> <span class=md-ellipsis> Production Settings </span> </a> </li> <li class=md-nav__item> <a href=#development-settings class=md-nav__link> <span class=md-ellipsis> Development Settings </span> </a> </li> <li class=md-nav__item> <a href=#laravel-opcache-package class=md-nav__link> <span class=md-ellipsis> Laravel OPcache Package </span> </a> </li> <li class=md-nav__item> <a href=#opcache class=md-nav__link> <span class=md-ellipsis> Очистка OPcache </span> </a> <nav class=md-nav aria-label="Очистка OPcache"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-cli class=md-nav__link> <span class=md-ellipsis> 1. CLI </span> </a> </li> <li class=md-nav__item> <a href=#2-http-endpoint class=md-nav__link> <span class=md-ellipsis> 2. HTTP Endpoint </span> </a> </li> <li class=md-nav__item> <a href=#3-deployment class=md-nav__link> <span class=md-ellipsis> 3. Deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#preloading-php-74 class=md-nav__link> <span class=md-ellipsis> Preloading (PHP 7.4+) </span> </a> </li> <li class=md-nav__item> <a href=#opcache_1 class=md-nav__link> <span class=md-ellipsis> Мониторинг OPcache </span> </a> </li> <li class=md-nav__item> <a href=#metrics class=md-nav__link> <span class=md-ellipsis> Metrics </span> </a> <nav class=md-nav aria-label=Metrics> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-hit-rate class=md-nav__link> <span class=md-ellipsis> 1. Hit Rate </span> </a> </li> <li class=md-nav__item> <a href=#2-memory-usage class=md-nav__link> <span class=md-ellipsis> 2. Memory Usage </span> </a> </li> <li class=md-nav__item> <a href=#3-cached-scripts class=md-nav__link> <span class=md-ellipsis> 3. Cached Scripts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> Проблемы и решения </span> </a> <nav class=md-nav aria-label="Проблемы и решения"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-stale-code-after-deploy class=md-nav__link> <span class=md-ellipsis> 1. Stale Code After Deploy </span> </a> </li> <li class=md-nav__item> <a href=#2-out-of-memory class=md-nav__link> <span class=md-ellipsis> 2. Out of Memory </span> </a> </li> <li class=md-nav__item> <a href=#3-too-many-files class=md-nav__link> <span class=md-ellipsis> 3. Too Many Files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#comparison-caches class=md-nav__link> <span class=md-ellipsis> Comparison с другими caches </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> Автоматизация </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> На собеседовании скажешь </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> Практические задания </span> </a> <nav class=md-nav aria-label="Практические задания"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-opcache-monitoring-dashboard class=md-nav__link> <span class=md-ellipsis> Задание 1: OPcache Monitoring Dashboard </span> </a> </li> <li class=md-nav__item> <a href=#2-smart-opcache-preloading-generator class=md-nav__link> <span class=md-ellipsis> Задание 2: Smart OPcache Preloading Generator </span> </a> </li> <li class=md-nav__item> <a href=#3-automated-deploy-with-opcache-management class=md-nav__link> <span class=md-ellipsis> Задание 3: Automated Deploy with OPcache Management </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_16> <label class=md-nav__link for=__nav_16 id=__nav_16_label tabindex=0> <span class=md-ellipsis> Performance </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_16_label aria-expanded=false> <label class=md-nav__title for=__nav_16> <span class="md-nav__icon md-icon"></span> Performance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../15-performance/01-caching/ class=md-nav__link> <span class=md-ellipsis> Caching </span> </a> </li> <li class=md-nav__item> <a href=../../15-performance/02-database-optimization/ class=md-nav__link> <span class=md-ellipsis> Database Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../15-performance/03-query-optimization/ class=md-nav__link> <span class=md-ellipsis> Query Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../15-performance/04-frontend-optimization/ class=md-nav__link> <span class=md-ellipsis> Frontend Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../15-performance/05-php-optimization/ class=md-nav__link> <span class=md-ellipsis> PHP Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../15-performance/06-scaling/ class=md-nav__link> <span class=md-ellipsis> Scaling </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_17> <label class=md-nav__link for=__nav_17 id=__nav_17_label tabindex=0> <span class=md-ellipsis> Principles </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_17_label aria-expanded=false> <label class=md-nav__title for=__nav_17> <span class="md-nav__icon md-icon"></span> Principles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../16-principles/01-kiss-dry-yagni/ class=md-nav__link> <span class=md-ellipsis> KISS, DRY, YAGNI </span> </a> </li> <li class=md-nav__item> <a href=../../16-principles/02-grasp/ class=md-nav__link> <span class=md-ellipsis> GRASP </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_18> <label class=md-nav__link for=__nav_18 id=__nav_18_label tabindex=0> <span class=md-ellipsis> Architecture Patterns </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_18_label aria-expanded=false> <label class=md-nav__title for=__nav_18> <span class="md-nav__icon md-icon"></span> Architecture Patterns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../17-architecture-patterns/01-mvc/ class=md-nav__link> <span class=md-ellipsis> MVC </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/02-repository-pattern/ class=md-nav__link> <span class=md-ellipsis> Repository Pattern </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/03-service-layer/ class=md-nav__link> <span class=md-ellipsis> Service Layer </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/04-solid/ class=md-nav__link> <span class=md-ellipsis> SOLID </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/05-ddd/ class=md-nav__link> <span class=md-ellipsis> Domain-Driven Design </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/06-cqrs/ class=md-nav__link> <span class=md-ellipsis> CQRS </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/07-event-sourcing/ class=md-nav__link> <span class=md-ellipsis> Event Sourcing </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/08-dependency-injection/ class=md-nav__link> <span class=md-ellipsis> Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/09-factory-pattern/ class=md-nav__link> <span class=md-ellipsis> Factory Pattern </span> </a> </li> <li class=md-nav__item> <a href=../../17-architecture-patterns/10-observer-pattern/ class=md-nav__link> <span class=md-ellipsis> Observer Pattern </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_19> <label class=md-nav__link for=__nav_19 id=__nav_19_label tabindex=0> <span class=md-ellipsis> Design Patterns </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_19_label aria-expanded=false> <label class=md-nav__title for=__nav_19> <span class="md-nav__icon md-icon"></span> Design Patterns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../18-design-patterns/01-creational/ class=md-nav__link> <span class=md-ellipsis> Creational Patterns </span> </a> </li> <li class=md-nav__item> <a href=../../18-design-patterns/02-structural/ class=md-nav__link> <span class=md-ellipsis> Structural Patterns </span> </a> </li> <li class=md-nav__item> <a href=../../18-design-patterns/03-behavioral/ class=md-nav__link> <span class=md-ellipsis> Behavioral Patterns </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_20> <label class=md-nav__link for=__nav_20 id=__nav_20_label tabindex=0> <span class=md-ellipsis> Message Brokers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_20_label aria-expanded=false> <label class=md-nav__title for=__nav_20> <span class="md-nav__icon md-icon"></span> Message Brokers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../19-message-brokers/01-rabbitmq/ class=md-nav__link> <span class=md-ellipsis> RabbitMQ </span> </a> </li> <li class=md-nav__item> <a href=../../19-message-brokers/02-kafka/ class=md-nav__link> <span class=md-ellipsis> Kafka </span> </a> </li> <li class=md-nav__item> <a href=../../19-message-brokers/03-redis-pubsub/ class=md-nav__link> <span class=md-ellipsis> Redis Pub/Sub </span> </a> </li> <li class=md-nav__item> <a href=../../19-message-brokers/04-comparison/ class=md-nav__link> <span class=md-ellipsis> Comparison </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_21> <label class=md-nav__link for=__nav_21 id=__nav_21_label tabindex=0> <span class=md-ellipsis> Microservices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_21_label aria-expanded=false> <label class=md-nav__title for=__nav_21> <span class="md-nav__icon md-icon"></span> Microservices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../20-microservices/01-monolith-vs-microservices/ class=md-nav__link> <span class=md-ellipsis> Monolith vs Microservices </span> </a> </li> <li class=md-nav__item> <a href=../../20-microservices/02-api-gateway/ class=md-nav__link> <span class=md-ellipsis> API Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../20-microservices/03-circuit-breaker/ class=md-nav__link> <span class=md-ellipsis> Circuit Breaker </span> </a> </li> <li class=md-nav__item> <a href=../../20-microservices/04-service-discovery/ class=md-nav__link> <span class=md-ellipsis> Service Discovery </span> </a> </li> <li class=md-nav__item> <a href=../../20-microservices/05-saga-pattern/ class=md-nav__link> <span class=md-ellipsis> Saga Pattern </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_22> <label class=md-nav__link for=__nav_22 id=__nav_22_label tabindex=0> <span class=md-ellipsis> Soft Skills </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_22_label aria-expanded=false> <label class=md-nav__title for=__nav_22> <span class="md-nav__icon md-icon"></span> Soft Skills </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../21-soft-skills/01-code-review/ class=md-nav__link> <span class=md-ellipsis> Code Review </span> </a> </li> <li class=md-nav__item> <a href=../../21-soft-skills/02-agile-scrum/ class=md-nav__link> <span class=md-ellipsis> Agile & Scrum </span> </a> </li> <li class=md-nav__item> <a href=../../21-soft-skills/03-tech-interview/ class=md-nav__link> <span class=md-ellipsis> Tech Interview </span> </a> </li> <li class=md-nav__item> <a href=../../21-soft-skills/04-documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../21-soft-skills/05-time-management/ class=md-nav__link> <span class=md-ellipsis> Time Management </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_23> <label class=md-nav__link for=__nav_23 id=__nav_23_label tabindex=0> <span class=md-ellipsis> Practice </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_23_label aria-expanded=false> <label class=md-nav__title for=__nav_23> <span class="md-nav__icon md-icon"></span> Practice </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../22-practice/01-coding-challenges/ class=md-nav__link> <span class=md-ellipsis> Coding Challenges </span> </a> </li> <li class=md-nav__item> <a href=../../22-practice/02-system-design/ class=md-nav__link> <span class=md-ellipsis> System Design </span> </a> </li> <li class=md-nav__item> <a href=../../22-practice/03-debugging/ class=md-nav__link> <span class=md-ellipsis> Debugging </span> </a> </li> <li class=md-nav__item> <a href=../../22-practice/04-refactoring/ class=md-nav__link> <span class=md-ellipsis> Refactoring </span> </a> </li> <li class=md-nav__item> <a href=../../22-practice/05-real-world-cases/ class=md-nav__link> <span class=md-ellipsis> Real World Cases </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=Содержание> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Содержание </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> Краткое резюме </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> Содержание </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> Что это </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> Установка и конфигурация </span> </a> </li> <li class=md-nav__item> <a href=#production-settings class=md-nav__link> <span class=md-ellipsis> Production Settings </span> </a> </li> <li class=md-nav__item> <a href=#development-settings class=md-nav__link> <span class=md-ellipsis> Development Settings </span> </a> </li> <li class=md-nav__item> <a href=#laravel-opcache-package class=md-nav__link> <span class=md-ellipsis> Laravel OPcache Package </span> </a> </li> <li class=md-nav__item> <a href=#opcache class=md-nav__link> <span class=md-ellipsis> Очистка OPcache </span> </a> <nav class=md-nav aria-label="Очистка OPcache"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-cli class=md-nav__link> <span class=md-ellipsis> 1. CLI </span> </a> </li> <li class=md-nav__item> <a href=#2-http-endpoint class=md-nav__link> <span class=md-ellipsis> 2. HTTP Endpoint </span> </a> </li> <li class=md-nav__item> <a href=#3-deployment class=md-nav__link> <span class=md-ellipsis> 3. Deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#preloading-php-74 class=md-nav__link> <span class=md-ellipsis> Preloading (PHP 7.4+) </span> </a> </li> <li class=md-nav__item> <a href=#opcache_1 class=md-nav__link> <span class=md-ellipsis> Мониторинг OPcache </span> </a> </li> <li class=md-nav__item> <a href=#metrics class=md-nav__link> <span class=md-ellipsis> Metrics </span> </a> <nav class=md-nav aria-label=Metrics> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-hit-rate class=md-nav__link> <span class=md-ellipsis> 1. Hit Rate </span> </a> </li> <li class=md-nav__item> <a href=#2-memory-usage class=md-nav__link> <span class=md-ellipsis> 2. Memory Usage </span> </a> </li> <li class=md-nav__item> <a href=#3-cached-scripts class=md-nav__link> <span class=md-ellipsis> 3. Cached Scripts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> Проблемы и решения </span> </a> <nav class=md-nav aria-label="Проблемы и решения"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-stale-code-after-deploy class=md-nav__link> <span class=md-ellipsis> 1. Stale Code After Deploy </span> </a> </li> <li class=md-nav__item> <a href=#2-out-of-memory class=md-nav__link> <span class=md-ellipsis> 2. Out of Memory </span> </a> </li> <li class=md-nav__item> <a href=#3-too-many-files class=md-nav__link> <span class=md-ellipsis> 3. Too Many Files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#comparison-caches class=md-nav__link> <span class=md-ellipsis> Comparison с другими caches </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> Автоматизация </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> На собеседовании скажешь </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> Практические задания </span> </a> <nav class=md-nav aria-label="Практические задания"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-opcache-monitoring-dashboard class=md-nav__link> <span class=md-ellipsis> Задание 1: OPcache Monitoring Dashboard </span> </a> </li> <li class=md-nav__item> <a href=#2-smart-opcache-preloading-generator class=md-nav__link> <span class=md-ellipsis> Задание 2: Smart OPcache Preloading Generator </span> </a> </li> <li class=md-nav__item> <a href=#3-automated-deploy-with-opcache-management class=md-nav__link> <span class=md-ellipsis> Задание 3: Automated Deploy with OPcache Management </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=145-opcache>14.5 OPcache<a class=headerlink href=#145-opcache title="Permanent link">&para;</a></h1> <h2 id=_1>Краткое резюме<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <blockquote> <p><strong>OPcache</strong> — PHP bytecode cache, кэширует скомпилированный PHP код. 2-3x performance boost.</p> <p><strong>Production:</strong> <code>validate_timestamps=0</code> (не проверять изменения файлов), очищать после deploy (<code>php artisan opcache:clear</code>). <strong>Development:</strong> <code>validate_timestamps=1</code>, <code>revalidate_freq=0</code> (видеть изменения сразу).</p> <p><strong>Preloading</strong> (PHP 7.4+): загружать файлы в память при старте PHP-FPM. Monitoring: <strong>hit rate &gt; 99%</strong>, достаточно memory (256-512MB). Laravel: <code>appstract/laravel-opcache</code> package.</p> </blockquote> <hr> <h2 id=_2>Содержание<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <ul> <li><a href=#что-это>Что это</a></li> <li><a href=#установка-и-конфигурация>Установка и конфигурация</a></li> <li><a href=#production-settings>Production Settings</a></li> <li><a href=#development-settings>Development Settings</a></li> <li><a href=#очистка-opcache>Очистка OPcache</a></li> <li><a href=#preloading-php-74>Preloading</a></li> <li><a href=#мониторинг-opcache>Мониторинг OPcache</a></li> <li><a href=#best-practices>Best Practices</a></li> <li><a href=#на-собеседовании-скажешь>На собеседовании</a></li> <li><a href=#практические-задания>Практические задания</a></li> </ul> <hr> <h2 id=_3>Что это<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p><strong>OPcache:</strong> PHP bytecode cache. Кэширует скомпилированный PHP код (bytecode), чтобы не компилировать на каждом запросе.</p> <p><strong>Зачем:</strong> - Гораздо быстрее (не нужно парсить и компилировать PHP файлы) - Меньше CPU usage - 2-3x performance boost</p> <p><strong>Как работает:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>Без OPcache:
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>Request → PHP парсит файл → компилирует → выполняет → Response
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>С OPcache:
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>Request → OPcache (bytecode cache) → выполняет → Response
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>          ↑ если нет в cache
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>          PHP парсит → компилирует → сохраняет в cache
</span></code></pre></div> <hr> <h2 id=_4>Установка и конфигурация<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p><strong>Проверить установлен ли:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>php<span class=w> </span>-v
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=c1># Должно быть: with Zend OPcache</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>php<span class=w> </span>-m<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>opcache
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># opcache</span>
</span></code></pre></div> <p><strong>php.ini:</strong></p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>[opcache]</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=c1>; Включить OPcache</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=na>opcache.enable</span><span class=o>=</span><span class=s>1</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=c1>; Включить для CLI (optional)</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=na>opcache.enable_cli</span><span class=o>=</span><span class=s>0</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=c1>; Memory (MB)</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=na>opcache.memory_consumption</span><span class=o>=</span><span class=s>128</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=c1>; Interned strings buffer (MB)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=na>opcache.interned_strings_buffer</span><span class=o>=</span><span class=s>8</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=c1>; Max accelerated files</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=na>opcache.max_accelerated_files</span><span class=o>=</span><span class=s>10000</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=c1>; Revalidate frequency (seconds)</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=na>opcache.revalidate_freq</span><span class=o>=</span><span class=s>2</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=c1>; Validate timestamps (проверять изменения файлов)</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=na>opcache.validate_timestamps</span><span class=o>=</span><span class=s>1</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=c1>; Fast shutdown</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=na>opcache.fast_shutdown</span><span class=o>=</span><span class=s>1</span>
</span></code></pre></div> <hr> <h2 id=production-settings>Production Settings<a class=headerlink href=#production-settings title="Permanent link">&para;</a></h2> <p><strong>php.ini (production):</strong></p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>[opcache]</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=na>opcache.enable</span><span class=o>=</span><span class=s>1</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=na>opcache.memory_consumption</span><span class=o>=</span><span class=s>256</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=na>opcache.interned_strings_buffer</span><span class=o>=</span><span class=s>16</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=na>opcache.max_accelerated_files</span><span class=o>=</span><span class=s>20000</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=c1>; ВАЖНО: отключить revalidate для максимальной производительности</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=na>opcache.validate_timestamps</span><span class=o>=</span><span class=s>0</span><span class=w>  </span><span class=c1># не проверять изменения файлов</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=na>opcache.revalidate_freq</span><span class=o>=</span><span class=s>0</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=na>opcache.fast_shutdown</span><span class=o>=</span><span class=s>1</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=na>opcache.enable_file_override</span><span class=o>=</span><span class=s>1</span>
</span></code></pre></div> <p><strong>После deploy:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># Очистить OPcache</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>php<span class=w> </span>artisan<span class=w> </span>opcache:clear<span class=w>  </span><span class=c1># Laravel</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1># Или через nginx/apache</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>curl<span class=w> </span>http://example.com/opcache-clear.php
</span></code></pre></div> <hr> <h2 id=development-settings>Development Settings<a class=headerlink href=#development-settings title="Permanent link">&para;</a></h2> <p><strong>php.ini (development):</strong></p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>[opcache]</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=na>opcache.enable</span><span class=o>=</span><span class=s>1</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=na>opcache.validate_timestamps</span><span class=o>=</span><span class=s>1</span><span class=w>  </span><span class=c1># проверять изменения</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=na>opcache.revalidate_freq</span><span class=o>=</span><span class=s>0</span><span class=w>       </span><span class=c1># проверять каждый раз</span>
</span></code></pre></div> <p><strong>Почему:</strong> - Изменения в коде видны сразу (не нужно перезагружать PHP-FPM)</p> <hr> <h2 id=laravel-opcache-package>Laravel OPcache Package<a class=headerlink href=#laravel-opcache-package title="Permanent link">&para;</a></h2> <p><strong>Composer:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>composer<span class=w> </span>require<span class=w> </span>appstract/laravel-opcache
</span></code></pre></div> <p><strong>Routes:</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=x>// Автоматически регистрируются</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=x>// /opcache/clear</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=x>// /opcache/config</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=x>// /opcache/status</span>
</span></code></pre></div> <p><strong>Artisan:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Clear OPcache</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>php<span class=w> </span>artisan<span class=w> </span>opcache:clear
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=c1># Status</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>php<span class=w> </span>artisan<span class=w> </span>opcache:status
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=c1># Config</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>php<span class=w> </span>artisan<span class=w> </span>opcache:config
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=c1># Optimize (preload)</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>php<span class=w> </span>artisan<span class=w> </span>opcache:optimize
</span></code></pre></div> <hr> <h2 id=opcache>Очистка OPcache<a class=headerlink href=#opcache title="Permanent link">&para;</a></h2> <h3 id=1-cli>1. CLI<a class=headerlink href=#1-cli title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>php<span class=w> </span>artisan<span class=w> </span>opcache:clear
</span></code></pre></div> <hr> <h3 id=2-http-endpoint>2. HTTP Endpoint<a class=headerlink href=#2-http-endpoint title="Permanent link">&para;</a></h3> <p><strong>routes/web.php:</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=x>Route::get(&#39;/opcache/clear&#39;, function () {</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=x>    if (function_exists(&#39;opcache_reset&#39;)) {</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=x>        opcache_reset();</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=x>        return &#39;OPcache cleared&#39;;</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=x>    }</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=x>    return &#39;OPcache not available&#39;;</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=x>})-&gt;middleware(&#39;auth&#39;);  // Защитить!</span>
</span></code></pre></div> <hr> <h3 id=3-deployment>3. Deployment<a class=headerlink href=#3-deployment title="Permanent link">&para;</a></h3> <p><strong>Deploy script:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=c1># Pull code</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>git<span class=w> </span>pull
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=c1># Install dependencies</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>composer<span class=w> </span>install<span class=w> </span>--no-dev<span class=w> </span>--optimize-autoloader
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=c1># Clear caches</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>php<span class=w> </span>artisan<span class=w> </span>config:cache
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>php<span class=w> </span>artisan<span class=w> </span>route:cache
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>php<span class=w> </span>artisan<span class=w> </span>view:cache
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=c1># Clear OPcache</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>php<span class=w> </span>artisan<span class=w> </span>opcache:clear
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=c1># Reload PHP-FPM</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>sudo<span class=w> </span>systemctl<span class=w> </span>reload<span class=w> </span>php8.2-fpm
</span></code></pre></div> <hr> <h2 id=preloading-php-74>Preloading (PHP 7.4+)<a class=headerlink href=#preloading-php-74 title="Permanent link">&para;</a></h2> <p><strong>Что это:</strong> Загрузить PHP файлы в память при старте PHP-FPM.</p> <p><strong>php.ini:</strong></p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=na>opcache.preload</span><span class=o>=</span><span class=s>/var/www/html/preload.php</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=na>opcache.preload_user</span><span class=o>=</span><span class=s>www-data</span>
</span></code></pre></div> <p><strong>preload.php:</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=cp>&lt;?php</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=c1>// Laravel preload script</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=k>require</span> <span class=no>__DIR__</span> <span class=o>.</span> <span class=s1>&#39;/vendor/autoload.php&#39;</span><span class=p>;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=nv>$app</span> <span class=o>=</span> <span class=k>require_once</span> <span class=no>__DIR__</span> <span class=o>.</span> <span class=s1>&#39;/bootstrap/app.php&#39;</span><span class=p>;</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=nv>$kernel</span> <span class=o>=</span> <span class=nv>$app</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>Illuminate\Contracts\Http\Kernel</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=c1>// Preload Laravel core</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=nb>opcache_compile_file</span><span class=p>(</span><span class=no>__DIR__</span> <span class=o>.</span> <span class=s1>&#39;/vendor/laravel/framework/src/Illuminate/Foundation/Application.php&#39;</span><span class=p>);</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=nb>opcache_compile_file</span><span class=p>(</span><span class=no>__DIR__</span> <span class=o>.</span> <span class=s1>&#39;/vendor/laravel/framework/src/Illuminate/Http/Request.php&#39;</span><span class=p>);</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=c1>// ... другие часто используемые файлы</span>
</span></code></pre></div> <p><strong>Laravel Automatic Preload:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Generate preload file</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>php<span class=w> </span>artisan<span class=w> </span>opcache:optimize
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># Создаст bootstrap/cache/opcache.php</span>
</span></code></pre></div> <hr> <h2 id=opcache_1>Мониторинг OPcache<a class=headerlink href=#opcache_1 title="Permanent link">&para;</a></h2> <p><strong>PHP Code:</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=x>$status = opcache_get_status();</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=x>echo &quot;Memory Used: &quot; . $status[&#39;memory_usage&#39;][&#39;used_memory&#39;] / 1024 / 1024 . &quot; MB\n&quot;;</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=x>echo &quot;Memory Free: &quot; . $status[&#39;memory_usage&#39;][&#39;free_memory&#39;] / 1024 / 1024 . &quot; MB\n&quot;;</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=x>echo &quot;Hit Rate: &quot; . ($status[&#39;opcache_statistics&#39;][&#39;opcache_hit_rate&#39;]) . &quot;%\n&quot;;</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=x>echo &quot;Cached Scripts: &quot; . $status[&#39;opcache_statistics&#39;][&#39;num_cached_scripts&#39;] . &quot;\n&quot;;</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=x>echo &quot;Max Cached Scripts: &quot; . $status[&#39;opcache_statistics&#39;][&#39;max_cached_scripts&#39;] . &quot;\n&quot;;</span>
</span></code></pre></div> <p><strong>Artisan:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>php<span class=w> </span>artisan<span class=w> </span>opcache:status
</span></code></pre></div> <hr> <h2 id=metrics>Metrics<a class=headerlink href=#metrics title="Permanent link">&para;</a></h2> <p><strong>Важные метрики:</strong></p> <h3 id=1-hit-rate>1. Hit Rate<a class=headerlink href=#1-hit-rate title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>opcache_hit_rate = (hits / (hits + misses)) * 100
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>&gt; 99% — отлично
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>&lt; 95% — нужно больше памяти или max_accelerated_files
</span></code></pre></div> <hr> <h3 id=2-memory-usage>2. Memory Usage<a class=headerlink href=#2-memory-usage title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>Если used_memory близко к memory_consumption:
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>→ увеличить opcache.memory_consumption
</span></code></pre></div> <hr> <h3 id=3-cached-scripts>3. Cached Scripts<a class=headerlink href=#3-cached-scripts title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>Если num_cached_scripts близко к max_accelerated_files:
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>→ увеличить opcache.max_accelerated_files
</span></code></pre></div> <hr> <h2 id=_5>Проблемы и решения<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <h3 id=1-stale-code-after-deploy>1. Stale Code After Deploy<a class=headerlink href=#1-stale-code-after-deploy title="Permanent link">&para;</a></h3> <p><strong>Проблема:</strong> После deploy старый код в OPcache.</p> <p><strong>Решение:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Очистить OPcache</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>php<span class=w> </span>artisan<span class=w> </span>opcache:clear
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1># Или перезагрузить PHP-FPM</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>sudo<span class=w> </span>systemctl<span class=w> </span>reload<span class=w> </span>php8.2-fpm
</span></code></pre></div> <hr> <h3 id=2-out-of-memory>2. Out of Memory<a class=headerlink href=#2-out-of-memory title="Permanent link">&para;</a></h3> <p><strong>Проблема:</strong> OPcache закончилась память.</p> <p><strong>Решение:</strong></p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1>; Увеличить memory</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=na>opcache.memory_consumption</span><span class=o>=</span><span class=s>512</span><span class=w>  </span><span class=c1># было 256</span>
</span></code></pre></div> <hr> <h3 id=3-too-many-files>3. Too Many Files<a class=headerlink href=#3-too-many-files title="Permanent link">&para;</a></h3> <p><strong>Проблема:</strong> <code>max_accelerated_files</code> достигнут.</p> <p><strong>Решение:</strong></p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=na>opcache.max_accelerated_files</span><span class=o>=</span><span class=s>30000</span><span class=w>  </span><span class=c1># было 10000</span>
</span></code></pre></div> <hr> <h2 id=best-practices>Best Practices<a class=headerlink href=#best-practices title="Permanent link">&para;</a></h2> <div class="language-text highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>✓ Production: validate_timestamps=0 (максимальная производительность)
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>✓ Development: validate_timestamps=1, revalidate_freq=0
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>✓ Достаточно memory (256-512 MB)
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>✓ max_accelerated_files &gt; количество PHP файлов
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>✓ Очищать OPcache после deploy
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>✓ Preloading для часто используемых файлов (PHP 7.4+)
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>✓ Мониторинг hit rate (&gt; 99%)
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>✓ Защитить /opcache/clear endpoint (auth)
</span></code></pre></div> <hr> <h2 id=comparison-caches>Comparison с другими caches<a class=headerlink href=#comparison-caches title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Cache</th> <th>Что кэширует</th> <th>Scope</th> </tr> </thead> <tbody> <tr> <td>OPcache</td> <td>PHP bytecode</td> <td>Per PHP-FPM worker</td> </tr> <tr> <td>APCu</td> <td>User data (key-value)</td> <td>Per PHP-FPM worker</td> </tr> <tr> <td>Redis</td> <td>Application data</td> <td>Shared (все workers)</td> </tr> <tr> <td>Memcached</td> <td>Application data</td> <td>Shared (все workers)</td> </tr> </tbody> </table> <p><strong>OPcache — низкоуровневый cache (PHP bytecode).</strong></p> <p><strong>Redis/Memcached — высокоуровневый cache (application data).</strong></p> <hr> <h2 id=_6>Автоматизация<a class=headerlink href=#_6 title="Permanent link">&para;</a></h2> <p><strong>Deploy Hook:</strong></p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># .gitlab-ci.yml</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">git pull</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">composer install --no-dev --optimize-autoloader</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php artisan config:cache</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php artisan route:cache</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php artisan view:cache</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">php artisan opcache:clear</span><span class=w>  </span><span class=c1># Очистить OPcache</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sudo systemctl reload php8.2-fpm</span>
</span></code></pre></div> <hr> <h2 id=_7>На собеседовании скажешь<a class=headerlink href=#_7 title="Permanent link">&para;</a></h2> <blockquote> <p>"OPcache — PHP bytecode cache, кэширует скомпилированный PHP код. 2-3x performance boost. Production: validate_timestamps=0 (не проверять изменения файлов), очищать после deploy. Development: validate_timestamps=1, revalidate_freq=0 (видеть изменения сразу). Preloading (PHP 7.4+): загружать файлы в память при старте. Monitoring: hit rate &gt; 99%, достаточно memory. Laravel: appstract/laravel-opcache package, php artisan opcache:clear. Best practices: достаточно memory (256-512MB), max_accelerated_files &gt; количество файлов, защитить clear endpoint, автоматизировать clear в deploy."</p> </blockquote> <hr> <h2 id=_8>Практические задания<a class=headerlink href=#_8 title="Permanent link">&para;</a></h2> <h3 id=1-opcache-monitoring-dashboard>Задание 1: OPcache Monitoring Dashboard<a class=headerlink href=#1-opcache-monitoring-dashboard title="Permanent link">&para;</a></h3> <p>Создай сервис для мониторинга OPcache с метриками: hit rate, memory usage, cached scripts. Добавь artisan command для вывода статистики.</p> <details> <summary>Решение</summary> <div class="language-php highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=x>namespace App\Services;</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=x>class OPcacheMonitoringService</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=x>{</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=x>    /**</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=x>     * Получить статус OPcache</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=x>     */</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=x>    public function getStatus(): array</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=x>    {</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=x>        if (!function_exists(&#39;opcache_get_status&#39;)) {</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=x>            return [&#39;enabled&#39; =&gt; false];</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=x>        }</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=x>        $status = opcache_get_status(false);</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=x>        $config = opcache_get_configuration();</span>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=x>        if ($status === false) {</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a><span class=x>            return [&#39;enabled&#39; =&gt; false];</span>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=x>        }</span>
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a><span class=x>        return [</span>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a><span class=x>            &#39;enabled&#39; =&gt; true,</span>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a><span class=x>            &#39;version&#39; =&gt; $config[&#39;version&#39;][&#39;version&#39;] ?? &#39;unknown&#39;,</span>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a><span class=x>            &#39;memory&#39; =&gt; $this-&gt;getMemoryStats($status),</span>
</span><span id=__span-25-25><a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a><span class=x>            &#39;statistics&#39; =&gt; $this-&gt;getStatistics($status),</span>
</span><span id=__span-25-26><a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a><span class=x>            &#39;scripts&#39; =&gt; $this-&gt;getScriptsStats($status),</span>
</span><span id=__span-25-27><a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a><span class=x>            &#39;config&#39; =&gt; $this-&gt;getImportantConfig($config),</span>
</span><span id=__span-25-28><a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a><span class=x>        ];</span>
</span><span id=__span-25-29><a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a><span class=x>    }</span>
</span><span id=__span-25-30><a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a>
</span><span id=__span-25-31><a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a><span class=x>    private function getMemoryStats(array $status): array</span>
</span><span id=__span-25-32><a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a><span class=x>    {</span>
</span><span id=__span-25-33><a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a><span class=x>        $memory = $status[&#39;memory_usage&#39;];</span>
</span><span id=__span-25-34><a id=__codelineno-25-34 name=__codelineno-25-34 href=#__codelineno-25-34></a>
</span><span id=__span-25-35><a id=__codelineno-25-35 name=__codelineno-25-35 href=#__codelineno-25-35></a><span class=x>        $total = $memory[&#39;used_memory&#39;] + $memory[&#39;free_memory&#39;];</span>
</span><span id=__span-25-36><a id=__codelineno-25-36 name=__codelineno-25-36 href=#__codelineno-25-36></a><span class=x>        $usagePercent = $total &gt; 0 ? round(($memory[&#39;used_memory&#39;] / $total) * 100, 2) : 0;</span>
</span><span id=__span-25-37><a id=__codelineno-25-37 name=__codelineno-25-37 href=#__codelineno-25-37></a>
</span><span id=__span-25-38><a id=__codelineno-25-38 name=__codelineno-25-38 href=#__codelineno-25-38></a><span class=x>        return [</span>
</span><span id=__span-25-39><a id=__codelineno-25-39 name=__codelineno-25-39 href=#__codelineno-25-39></a><span class=x>            &#39;used_mb&#39; =&gt; round($memory[&#39;used_memory&#39;] / 1024 / 1024, 2),</span>
</span><span id=__span-25-40><a id=__codelineno-25-40 name=__codelineno-25-40 href=#__codelineno-25-40></a><span class=x>            &#39;free_mb&#39; =&gt; round($memory[&#39;free_memory&#39;] / 1024 / 1024, 2),</span>
</span><span id=__span-25-41><a id=__codelineno-25-41 name=__codelineno-25-41 href=#__codelineno-25-41></a><span class=x>            &#39;wasted_mb&#39; =&gt; round($memory[&#39;wasted_memory&#39;] / 1024 / 1024, 2),</span>
</span><span id=__span-25-42><a id=__codelineno-25-42 name=__codelineno-25-42 href=#__codelineno-25-42></a><span class=x>            &#39;total_mb&#39; =&gt; round($total / 1024 / 1024, 2),</span>
</span><span id=__span-25-43><a id=__codelineno-25-43 name=__codelineno-25-43 href=#__codelineno-25-43></a><span class=x>            &#39;usage_percent&#39; =&gt; $usagePercent,</span>
</span><span id=__span-25-44><a id=__codelineno-25-44 name=__codelineno-25-44 href=#__codelineno-25-44></a><span class=x>            &#39;wasted_percent&#39; =&gt; $total &gt; 0</span>
</span><span id=__span-25-45><a id=__codelineno-25-45 name=__codelineno-25-45 href=#__codelineno-25-45></a><span class=x>                ? round(($memory[&#39;wasted_memory&#39;] / $total) * 100, 2)</span>
</span><span id=__span-25-46><a id=__codelineno-25-46 name=__codelineno-25-46 href=#__codelineno-25-46></a><span class=x>                : 0,</span>
</span><span id=__span-25-47><a id=__codelineno-25-47 name=__codelineno-25-47 href=#__codelineno-25-47></a><span class=x>        ];</span>
</span><span id=__span-25-48><a id=__codelineno-25-48 name=__codelineno-25-48 href=#__codelineno-25-48></a><span class=x>    }</span>
</span><span id=__span-25-49><a id=__codelineno-25-49 name=__codelineno-25-49 href=#__codelineno-25-49></a>
</span><span id=__span-25-50><a id=__codelineno-25-50 name=__codelineno-25-50 href=#__codelineno-25-50></a><span class=x>    private function getStatistics(array $status): array</span>
</span><span id=__span-25-51><a id=__codelineno-25-51 name=__codelineno-25-51 href=#__codelineno-25-51></a><span class=x>    {</span>
</span><span id=__span-25-52><a id=__codelineno-25-52 name=__codelineno-25-52 href=#__codelineno-25-52></a><span class=x>        $stats = $status[&#39;opcache_statistics&#39;];</span>
</span><span id=__span-25-53><a id=__codelineno-25-53 name=__codelineno-25-53 href=#__codelineno-25-53></a>
</span><span id=__span-25-54><a id=__codelineno-25-54 name=__codelineno-25-54 href=#__codelineno-25-54></a><span class=x>        $total = $stats[&#39;hits&#39;] + $stats[&#39;misses&#39;];</span>
</span><span id=__span-25-55><a id=__codelineno-25-55 name=__codelineno-25-55 href=#__codelineno-25-55></a><span class=x>        $hitRate = $total &gt; 0 ? round(($stats[&#39;hits&#39;] / $total) * 100, 2) : 0;</span>
</span><span id=__span-25-56><a id=__codelineno-25-56 name=__codelineno-25-56 href=#__codelineno-25-56></a>
</span><span id=__span-25-57><a id=__codelineno-25-57 name=__codelineno-25-57 href=#__codelineno-25-57></a><span class=x>        return [</span>
</span><span id=__span-25-58><a id=__codelineno-25-58 name=__codelineno-25-58 href=#__codelineno-25-58></a><span class=x>            &#39;hits&#39; =&gt; $stats[&#39;hits&#39;],</span>
</span><span id=__span-25-59><a id=__codelineno-25-59 name=__codelineno-25-59 href=#__codelineno-25-59></a><span class=x>            &#39;misses&#39; =&gt; $stats[&#39;misses&#39;],</span>
</span><span id=__span-25-60><a id=__codelineno-25-60 name=__codelineno-25-60 href=#__codelineno-25-60></a><span class=x>            &#39;hit_rate&#39; =&gt; $hitRate,</span>
</span><span id=__span-25-61><a id=__codelineno-25-61 name=__codelineno-25-61 href=#__codelineno-25-61></a><span class=x>            &#39;blacklist_misses&#39; =&gt; $stats[&#39;blacklist_misses&#39;] ?? 0,</span>
</span><span id=__span-25-62><a id=__codelineno-25-62 name=__codelineno-25-62 href=#__codelineno-25-62></a><span class=x>            &#39;num_cached_scripts&#39; =&gt; $stats[&#39;num_cached_scripts&#39;],</span>
</span><span id=__span-25-63><a id=__codelineno-25-63 name=__codelineno-25-63 href=#__codelineno-25-63></a><span class=x>            &#39;max_cached_scripts&#39; =&gt; $stats[&#39;max_cached_scripts&#39;],</span>
</span><span id=__span-25-64><a id=__codelineno-25-64 name=__codelineno-25-64 href=#__codelineno-25-64></a><span class=x>            &#39;scripts_usage_percent&#39; =&gt; $stats[&#39;max_cached_scripts&#39;] &gt; 0</span>
</span><span id=__span-25-65><a id=__codelineno-25-65 name=__codelineno-25-65 href=#__codelineno-25-65></a><span class=x>                ? round(($stats[&#39;num_cached_scripts&#39;] / $stats[&#39;max_cached_scripts&#39;]) * 100, 2)</span>
</span><span id=__span-25-66><a id=__codelineno-25-66 name=__codelineno-25-66 href=#__codelineno-25-66></a><span class=x>                : 0,</span>
</span><span id=__span-25-67><a id=__codelineno-25-67 name=__codelineno-25-67 href=#__codelineno-25-67></a><span class=x>            &#39;oom_restarts&#39; =&gt; $stats[&#39;oom_restarts&#39;] ?? 0,</span>
</span><span id=__span-25-68><a id=__codelineno-25-68 name=__codelineno-25-68 href=#__codelineno-25-68></a><span class=x>            &#39;hash_restarts&#39; =&gt; $stats[&#39;hash_restarts&#39;] ?? 0,</span>
</span><span id=__span-25-69><a id=__codelineno-25-69 name=__codelineno-25-69 href=#__codelineno-25-69></a><span class=x>            &#39;manual_restarts&#39; =&gt; $stats[&#39;manual_restarts&#39;] ?? 0,</span>
</span><span id=__span-25-70><a id=__codelineno-25-70 name=__codelineno-25-70 href=#__codelineno-25-70></a><span class=x>        ];</span>
</span><span id=__span-25-71><a id=__codelineno-25-71 name=__codelineno-25-71 href=#__codelineno-25-71></a><span class=x>    }</span>
</span><span id=__span-25-72><a id=__codelineno-25-72 name=__codelineno-25-72 href=#__codelineno-25-72></a>
</span><span id=__span-25-73><a id=__codelineno-25-73 name=__codelineno-25-73 href=#__codelineno-25-73></a><span class=x>    private function getScriptsStats(array $status): array</span>
</span><span id=__span-25-74><a id=__codelineno-25-74 name=__codelineno-25-74 href=#__codelineno-25-74></a><span class=x>    {</span>
</span><span id=__span-25-75><a id=__codelineno-25-75 name=__codelineno-25-75 href=#__codelineno-25-75></a><span class=x>        $scripts = $status[&#39;scripts&#39;] ?? [];</span>
</span><span id=__span-25-76><a id=__codelineno-25-76 name=__codelineno-25-76 href=#__codelineno-25-76></a>
</span><span id=__span-25-77><a id=__codelineno-25-77 name=__codelineno-25-77 href=#__codelineno-25-77></a><span class=x>        return [</span>
</span><span id=__span-25-78><a id=__codelineno-25-78 name=__codelineno-25-78 href=#__codelineno-25-78></a><span class=x>            &#39;count&#39; =&gt; count($scripts),</span>
</span><span id=__span-25-79><a id=__codelineno-25-79 name=__codelineno-25-79 href=#__codelineno-25-79></a><span class=x>            &#39;total_size_mb&#39; =&gt; round(</span>
</span><span id=__span-25-80><a id=__codelineno-25-80 name=__codelineno-25-80 href=#__codelineno-25-80></a><span class=x>                array_sum(array_column($scripts, &#39;memory_consumption&#39;)) / 1024 / 1024,</span>
</span><span id=__span-25-81><a id=__codelineno-25-81 name=__codelineno-25-81 href=#__codelineno-25-81></a><span class=x>                2</span>
</span><span id=__span-25-82><a id=__codelineno-25-82 name=__codelineno-25-82 href=#__codelineno-25-82></a><span class=x>            ),</span>
</span><span id=__span-25-83><a id=__codelineno-25-83 name=__codelineno-25-83 href=#__codelineno-25-83></a><span class=x>        ];</span>
</span><span id=__span-25-84><a id=__codelineno-25-84 name=__codelineno-25-84 href=#__codelineno-25-84></a><span class=x>    }</span>
</span><span id=__span-25-85><a id=__codelineno-25-85 name=__codelineno-25-85 href=#__codelineno-25-85></a>
</span><span id=__span-25-86><a id=__codelineno-25-86 name=__codelineno-25-86 href=#__codelineno-25-86></a><span class=x>    private function getImportantConfig(array $config): array</span>
</span><span id=__span-25-87><a id=__codelineno-25-87 name=__codelineno-25-87 href=#__codelineno-25-87></a><span class=x>    {</span>
</span><span id=__span-25-88><a id=__codelineno-25-88 name=__codelineno-25-88 href=#__codelineno-25-88></a><span class=x>        $directives = $config[&#39;directives&#39;];</span>
</span><span id=__span-25-89><a id=__codelineno-25-89 name=__codelineno-25-89 href=#__codelineno-25-89></a>
</span><span id=__span-25-90><a id=__codelineno-25-90 name=__codelineno-25-90 href=#__codelineno-25-90></a><span class=x>        return [</span>
</span><span id=__span-25-91><a id=__codelineno-25-91 name=__codelineno-25-91 href=#__codelineno-25-91></a><span class=x>            &#39;memory_consumption&#39; =&gt; $directives[&#39;opcache.memory_consumption&#39;] ?? 0,</span>
</span><span id=__span-25-92><a id=__codelineno-25-92 name=__codelineno-25-92 href=#__codelineno-25-92></a><span class=x>            &#39;interned_strings_buffer&#39; =&gt; $directives[&#39;opcache.interned_strings_buffer&#39;] ?? 0,</span>
</span><span id=__span-25-93><a id=__codelineno-25-93 name=__codelineno-25-93 href=#__codelineno-25-93></a><span class=x>            &#39;max_accelerated_files&#39; =&gt; $directives[&#39;opcache.max_accelerated_files&#39;] ?? 0,</span>
</span><span id=__span-25-94><a id=__codelineno-25-94 name=__codelineno-25-94 href=#__codelineno-25-94></a><span class=x>            &#39;validate_timestamps&#39; =&gt; (bool)($directives[&#39;opcache.validate_timestamps&#39;] ?? false),</span>
</span><span id=__span-25-95><a id=__codelineno-25-95 name=__codelineno-25-95 href=#__codelineno-25-95></a><span class=x>            &#39;revalidate_freq&#39; =&gt; $directives[&#39;opcache.revalidate_freq&#39;] ?? 0,</span>
</span><span id=__span-25-96><a id=__codelineno-25-96 name=__codelineno-25-96 href=#__codelineno-25-96></a><span class=x>            &#39;preload&#39; =&gt; $directives[&#39;opcache.preload&#39;] ?? &#39;&#39;,</span>
</span><span id=__span-25-97><a id=__codelineno-25-97 name=__codelineno-25-97 href=#__codelineno-25-97></a><span class=x>        ];</span>
</span><span id=__span-25-98><a id=__codelineno-25-98 name=__codelineno-25-98 href=#__codelineno-25-98></a><span class=x>    }</span>
</span><span id=__span-25-99><a id=__codelineno-25-99 name=__codelineno-25-99 href=#__codelineno-25-99></a>
</span><span id=__span-25-100><a id=__codelineno-25-100 name=__codelineno-25-100 href=#__codelineno-25-100></a><span class=x>    /**</span>
</span><span id=__span-25-101><a id=__codelineno-25-101 name=__codelineno-25-101 href=#__codelineno-25-101></a><span class=x>     * Проверить здоровье OPcache</span>
</span><span id=__span-25-102><a id=__codelineno-25-102 name=__codelineno-25-102 href=#__codelineno-25-102></a><span class=x>     */</span>
</span><span id=__span-25-103><a id=__codelineno-25-103 name=__codelineno-25-103 href=#__codelineno-25-103></a><span class=x>    public function healthCheck(): array</span>
</span><span id=__span-25-104><a id=__codelineno-25-104 name=__codelineno-25-104 href=#__codelineno-25-104></a><span class=x>    {</span>
</span><span id=__span-25-105><a id=__codelineno-25-105 name=__codelineno-25-105 href=#__codelineno-25-105></a><span class=x>        $status = $this-&gt;getStatus();</span>
</span><span id=__span-25-106><a id=__codelineno-25-106 name=__codelineno-25-106 href=#__codelineno-25-106></a>
</span><span id=__span-25-107><a id=__codelineno-25-107 name=__codelineno-25-107 href=#__codelineno-25-107></a><span class=x>        if (!$status[&#39;enabled&#39;]) {</span>
</span><span id=__span-25-108><a id=__codelineno-25-108 name=__codelineno-25-108 href=#__codelineno-25-108></a><span class=x>            return [</span>
</span><span id=__span-25-109><a id=__codelineno-25-109 name=__codelineno-25-109 href=#__codelineno-25-109></a><span class=x>                &#39;healthy&#39; =&gt; false,</span>
</span><span id=__span-25-110><a id=__codelineno-25-110 name=__codelineno-25-110 href=#__codelineno-25-110></a><span class=x>                &#39;issues&#39; =&gt; [&#39;OPcache is not enabled&#39;],</span>
</span><span id=__span-25-111><a id=__codelineno-25-111 name=__codelineno-25-111 href=#__codelineno-25-111></a><span class=x>            ];</span>
</span><span id=__span-25-112><a id=__codelineno-25-112 name=__codelineno-25-112 href=#__codelineno-25-112></a><span class=x>        }</span>
</span><span id=__span-25-113><a id=__codelineno-25-113 name=__codelineno-25-113 href=#__codelineno-25-113></a>
</span><span id=__span-25-114><a id=__codelineno-25-114 name=__codelineno-25-114 href=#__codelineno-25-114></a><span class=x>        $issues = [];</span>
</span><span id=__span-25-115><a id=__codelineno-25-115 name=__codelineno-25-115 href=#__codelineno-25-115></a>
</span><span id=__span-25-116><a id=__codelineno-25-116 name=__codelineno-25-116 href=#__codelineno-25-116></a><span class=x>        // Проверить hit rate</span>
</span><span id=__span-25-117><a id=__codelineno-25-117 name=__codelineno-25-117 href=#__codelineno-25-117></a><span class=x>        if ($status[&#39;statistics&#39;][&#39;hit_rate&#39;] &lt; 95) {</span>
</span><span id=__span-25-118><a id=__codelineno-25-118 name=__codelineno-25-118 href=#__codelineno-25-118></a><span class=x>            $issues[] = &quot;Low hit rate: {$status[&#39;statistics&#39;][&#39;hit_rate&#39;]}% (should be &gt; 95%)&quot;;</span>
</span><span id=__span-25-119><a id=__codelineno-25-119 name=__codelineno-25-119 href=#__codelineno-25-119></a><span class=x>        }</span>
</span><span id=__span-25-120><a id=__codelineno-25-120 name=__codelineno-25-120 href=#__codelineno-25-120></a>
</span><span id=__span-25-121><a id=__codelineno-25-121 name=__codelineno-25-121 href=#__codelineno-25-121></a><span class=x>        // Проверить memory usage</span>
</span><span id=__span-25-122><a id=__codelineno-25-122 name=__codelineno-25-122 href=#__codelineno-25-122></a><span class=x>        if ($status[&#39;memory&#39;][&#39;usage_percent&#39;] &gt; 90) {</span>
</span><span id=__span-25-123><a id=__codelineno-25-123 name=__codelineno-25-123 href=#__codelineno-25-123></a><span class=x>            $issues[] = &quot;High memory usage: {$status[&#39;memory&#39;][&#39;usage_percent&#39;]}% (should be &lt; 90%)&quot;;</span>
</span><span id=__span-25-124><a id=__codelineno-25-124 name=__codelineno-25-124 href=#__codelineno-25-124></a><span class=x>        }</span>
</span><span id=__span-25-125><a id=__codelineno-25-125 name=__codelineno-25-125 href=#__codelineno-25-125></a>
</span><span id=__span-25-126><a id=__codelineno-25-126 name=__codelineno-25-126 href=#__codelineno-25-126></a><span class=x>        // Проверить scripts usage</span>
</span><span id=__span-25-127><a id=__codelineno-25-127 name=__codelineno-25-127 href=#__codelineno-25-127></a><span class=x>        if ($status[&#39;statistics&#39;][&#39;scripts_usage_percent&#39;] &gt; 90) {</span>
</span><span id=__span-25-128><a id=__codelineno-25-128 name=__codelineno-25-128 href=#__codelineno-25-128></a><span class=x>            $issues[] = &quot;High scripts usage: {$status[&#39;statistics&#39;][&#39;scripts_usage_percent&#39;]}% (should be &lt; 90%)&quot;;</span>
</span><span id=__span-25-129><a id=__codelineno-25-129 name=__codelineno-25-129 href=#__codelineno-25-129></a><span class=x>        }</span>
</span><span id=__span-25-130><a id=__codelineno-25-130 name=__codelineno-25-130 href=#__codelineno-25-130></a>
</span><span id=__span-25-131><a id=__codelineno-25-131 name=__codelineno-25-131 href=#__codelineno-25-131></a><span class=x>        // Проверить restarts</span>
</span><span id=__span-25-132><a id=__codelineno-25-132 name=__codelineno-25-132 href=#__codelineno-25-132></a><span class=x>        if ($status[&#39;statistics&#39;][&#39;oom_restarts&#39;] &gt; 0) {</span>
</span><span id=__span-25-133><a id=__codelineno-25-133 name=__codelineno-25-133 href=#__codelineno-25-133></a><span class=x>            $issues[] = &quot;OOM restarts detected: {$status[&#39;statistics&#39;][&#39;oom_restarts&#39;]}&quot;;</span>
</span><span id=__span-25-134><a id=__codelineno-25-134 name=__codelineno-25-134 href=#__codelineno-25-134></a><span class=x>        }</span>
</span><span id=__span-25-135><a id=__codelineno-25-135 name=__codelineno-25-135 href=#__codelineno-25-135></a>
</span><span id=__span-25-136><a id=__codelineno-25-136 name=__codelineno-25-136 href=#__codelineno-25-136></a><span class=x>        return [</span>
</span><span id=__span-25-137><a id=__codelineno-25-137 name=__codelineno-25-137 href=#__codelineno-25-137></a><span class=x>            &#39;healthy&#39; =&gt; empty($issues),</span>
</span><span id=__span-25-138><a id=__codelineno-25-138 name=__codelineno-25-138 href=#__codelineno-25-138></a><span class=x>            &#39;issues&#39; =&gt; $issues,</span>
</span><span id=__span-25-139><a id=__codelineno-25-139 name=__codelineno-25-139 href=#__codelineno-25-139></a><span class=x>        ];</span>
</span><span id=__span-25-140><a id=__codelineno-25-140 name=__codelineno-25-140 href=#__codelineno-25-140></a><span class=x>    }</span>
</span><span id=__span-25-141><a id=__codelineno-25-141 name=__codelineno-25-141 href=#__codelineno-25-141></a><span class=x>}</span>
</span><span id=__span-25-142><a id=__codelineno-25-142 name=__codelineno-25-142 href=#__codelineno-25-142></a>
</span><span id=__span-25-143><a id=__codelineno-25-143 name=__codelineno-25-143 href=#__codelineno-25-143></a><span class=x>// Artisan Command</span>
</span><span id=__span-25-144><a id=__codelineno-25-144 name=__codelineno-25-144 href=#__codelineno-25-144></a><span class=x>namespace App\Console\Commands;</span>
</span><span id=__span-25-145><a id=__codelineno-25-145 name=__codelineno-25-145 href=#__codelineno-25-145></a>
</span><span id=__span-25-146><a id=__codelineno-25-146 name=__codelineno-25-146 href=#__codelineno-25-146></a><span class=x>use App\Services\OPcacheMonitoringService;</span>
</span><span id=__span-25-147><a id=__codelineno-25-147 name=__codelineno-25-147 href=#__codelineno-25-147></a><span class=x>use Illuminate\Console\Command;</span>
</span><span id=__span-25-148><a id=__codelineno-25-148 name=__codelineno-25-148 href=#__codelineno-25-148></a>
</span><span id=__span-25-149><a id=__codelineno-25-149 name=__codelineno-25-149 href=#__codelineno-25-149></a><span class=x>class OPcacheStatusCommand extends Command</span>
</span><span id=__span-25-150><a id=__codelineno-25-150 name=__codelineno-25-150 href=#__codelineno-25-150></a><span class=x>{</span>
</span><span id=__span-25-151><a id=__codelineno-25-151 name=__codelineno-25-151 href=#__codelineno-25-151></a><span class=x>    protected $signature = &#39;opcache:status {--health : Show health check only}&#39;;</span>
</span><span id=__span-25-152><a id=__codelineno-25-152 name=__codelineno-25-152 href=#__codelineno-25-152></a><span class=x>    protected $description = &#39;Show OPcache status and statistics&#39;;</span>
</span><span id=__span-25-153><a id=__codelineno-25-153 name=__codelineno-25-153 href=#__codelineno-25-153></a>
</span><span id=__span-25-154><a id=__codelineno-25-154 name=__codelineno-25-154 href=#__codelineno-25-154></a><span class=x>    public function handle(OPcacheMonitoringService $service)</span>
</span><span id=__span-25-155><a id=__codelineno-25-155 name=__codelineno-25-155 href=#__codelineno-25-155></a><span class=x>    {</span>
</span><span id=__span-25-156><a id=__codelineno-25-156 name=__codelineno-25-156 href=#__codelineno-25-156></a><span class=x>        if ($this-&gt;option(&#39;health&#39;)) {</span>
</span><span id=__span-25-157><a id=__codelineno-25-157 name=__codelineno-25-157 href=#__codelineno-25-157></a><span class=x>            $health = $service-&gt;healthCheck();</span>
</span><span id=__span-25-158><a id=__codelineno-25-158 name=__codelineno-25-158 href=#__codelineno-25-158></a>
</span><span id=__span-25-159><a id=__codelineno-25-159 name=__codelineno-25-159 href=#__codelineno-25-159></a><span class=x>            if ($health[&#39;healthy&#39;]) {</span>
</span><span id=__span-25-160><a id=__codelineno-25-160 name=__codelineno-25-160 href=#__codelineno-25-160></a><span class=x>                $this-&gt;info(&#39;OPcache is healthy&#39;);</span>
</span><span id=__span-25-161><a id=__codelineno-25-161 name=__codelineno-25-161 href=#__codelineno-25-161></a><span class=x>            } else {</span>
</span><span id=__span-25-162><a id=__codelineno-25-162 name=__codelineno-25-162 href=#__codelineno-25-162></a><span class=x>                $this-&gt;error(&#39;OPcache has issues:&#39;);</span>
</span><span id=__span-25-163><a id=__codelineno-25-163 name=__codelineno-25-163 href=#__codelineno-25-163></a><span class=x>                foreach ($health[&#39;issues&#39;] as $issue) {</span>
</span><span id=__span-25-164><a id=__codelineno-25-164 name=__codelineno-25-164 href=#__codelineno-25-164></a><span class=x>                    $this-&gt;line(&quot;  - {$issue}&quot;);</span>
</span><span id=__span-25-165><a id=__codelineno-25-165 name=__codelineno-25-165 href=#__codelineno-25-165></a><span class=x>                }</span>
</span><span id=__span-25-166><a id=__codelineno-25-166 name=__codelineno-25-166 href=#__codelineno-25-166></a><span class=x>            }</span>
</span><span id=__span-25-167><a id=__codelineno-25-167 name=__codelineno-25-167 href=#__codelineno-25-167></a>
</span><span id=__span-25-168><a id=__codelineno-25-168 name=__codelineno-25-168 href=#__codelineno-25-168></a><span class=x>            return $health[&#39;healthy&#39;] ? 0 : 1;</span>
</span><span id=__span-25-169><a id=__codelineno-25-169 name=__codelineno-25-169 href=#__codelineno-25-169></a><span class=x>        }</span>
</span><span id=__span-25-170><a id=__codelineno-25-170 name=__codelineno-25-170 href=#__codelineno-25-170></a>
</span><span id=__span-25-171><a id=__codelineno-25-171 name=__codelineno-25-171 href=#__codelineno-25-171></a><span class=x>        $status = $service-&gt;getStatus();</span>
</span><span id=__span-25-172><a id=__codelineno-25-172 name=__codelineno-25-172 href=#__codelineno-25-172></a>
</span><span id=__span-25-173><a id=__codelineno-25-173 name=__codelineno-25-173 href=#__codelineno-25-173></a><span class=x>        if (!$status[&#39;enabled&#39;]) {</span>
</span><span id=__span-25-174><a id=__codelineno-25-174 name=__codelineno-25-174 href=#__codelineno-25-174></a><span class=x>            $this-&gt;error(&#39;OPcache is not enabled&#39;);</span>
</span><span id=__span-25-175><a id=__codelineno-25-175 name=__codelineno-25-175 href=#__codelineno-25-175></a><span class=x>            return 1;</span>
</span><span id=__span-25-176><a id=__codelineno-25-176 name=__codelineno-25-176 href=#__codelineno-25-176></a><span class=x>        }</span>
</span><span id=__span-25-177><a id=__codelineno-25-177 name=__codelineno-25-177 href=#__codelineno-25-177></a>
</span><span id=__span-25-178><a id=__codelineno-25-178 name=__codelineno-25-178 href=#__codelineno-25-178></a><span class=x>        $this-&gt;info(&#39;OPcache Status:&#39;);</span>
</span><span id=__span-25-179><a id=__codelineno-25-179 name=__codelineno-25-179 href=#__codelineno-25-179></a><span class=x>        $this-&gt;newLine();</span>
</span><span id=__span-25-180><a id=__codelineno-25-180 name=__codelineno-25-180 href=#__codelineno-25-180></a>
</span><span id=__span-25-181><a id=__codelineno-25-181 name=__codelineno-25-181 href=#__codelineno-25-181></a><span class=x>        // Memory</span>
</span><span id=__span-25-182><a id=__codelineno-25-182 name=__codelineno-25-182 href=#__codelineno-25-182></a><span class=x>        $this-&gt;line(&#39;&lt;fg=yellow&gt;Memory Usage:&lt;/&gt;&#39;);</span>
</span><span id=__span-25-183><a id=__codelineno-25-183 name=__codelineno-25-183 href=#__codelineno-25-183></a><span class=x>        $this-&gt;table(</span>
</span><span id=__span-25-184><a id=__codelineno-25-184 name=__codelineno-25-184 href=#__codelineno-25-184></a><span class=x>            [&#39;Metric&#39;, &#39;Value&#39;],</span>
</span><span id=__span-25-185><a id=__codelineno-25-185 name=__codelineno-25-185 href=#__codelineno-25-185></a><span class=x>            [</span>
</span><span id=__span-25-186><a id=__codelineno-25-186 name=__codelineno-25-186 href=#__codelineno-25-186></a><span class=x>                [&#39;Used&#39;, &quot;{$status[&#39;memory&#39;][&#39;used_mb&#39;]} MB&quot;],</span>
</span><span id=__span-25-187><a id=__codelineno-25-187 name=__codelineno-25-187 href=#__codelineno-25-187></a><span class=x>                [&#39;Free&#39;, &quot;{$status[&#39;memory&#39;][&#39;free_mb&#39;]} MB&quot;],</span>
</span><span id=__span-25-188><a id=__codelineno-25-188 name=__codelineno-25-188 href=#__codelineno-25-188></a><span class=x>                [&#39;Wasted&#39;, &quot;{$status[&#39;memory&#39;][&#39;wasted_mb&#39;]} MB&quot;],</span>
</span><span id=__span-25-189><a id=__codelineno-25-189 name=__codelineno-25-189 href=#__codelineno-25-189></a><span class=x>                [&#39;Total&#39;, &quot;{$status[&#39;memory&#39;][&#39;total_mb&#39;]} MB&quot;],</span>
</span><span id=__span-25-190><a id=__codelineno-25-190 name=__codelineno-25-190 href=#__codelineno-25-190></a><span class=x>                [&#39;Usage&#39;, &quot;{$status[&#39;memory&#39;][&#39;usage_percent&#39;]}%&quot;],</span>
</span><span id=__span-25-191><a id=__codelineno-25-191 name=__codelineno-25-191 href=#__codelineno-25-191></a><span class=x>            ]</span>
</span><span id=__span-25-192><a id=__codelineno-25-192 name=__codelineno-25-192 href=#__codelineno-25-192></a><span class=x>        );</span>
</span><span id=__span-25-193><a id=__codelineno-25-193 name=__codelineno-25-193 href=#__codelineno-25-193></a>
</span><span id=__span-25-194><a id=__codelineno-25-194 name=__codelineno-25-194 href=#__codelineno-25-194></a><span class=x>        // Statistics</span>
</span><span id=__span-25-195><a id=__codelineno-25-195 name=__codelineno-25-195 href=#__codelineno-25-195></a><span class=x>        $this-&gt;line(&#39;&lt;fg=yellow&gt;Statistics:&lt;/&gt;&#39;);</span>
</span><span id=__span-25-196><a id=__codelineno-25-196 name=__codelineno-25-196 href=#__codelineno-25-196></a><span class=x>        $this-&gt;table(</span>
</span><span id=__span-25-197><a id=__codelineno-25-197 name=__codelineno-25-197 href=#__codelineno-25-197></a><span class=x>            [&#39;Metric&#39;, &#39;Value&#39;],</span>
</span><span id=__span-25-198><a id=__codelineno-25-198 name=__codelineno-25-198 href=#__codelineno-25-198></a><span class=x>            [</span>
</span><span id=__span-25-199><a id=__codelineno-25-199 name=__codelineno-25-199 href=#__codelineno-25-199></a><span class=x>                [&#39;Hits&#39;, number_format($status[&#39;statistics&#39;][&#39;hits&#39;])],</span>
</span><span id=__span-25-200><a id=__codelineno-25-200 name=__codelineno-25-200 href=#__codelineno-25-200></a><span class=x>                [&#39;Misses&#39;, number_format($status[&#39;statistics&#39;][&#39;misses&#39;])],</span>
</span><span id=__span-25-201><a id=__codelineno-25-201 name=__codelineno-25-201 href=#__codelineno-25-201></a><span class=x>                [&#39;Hit Rate&#39;, &quot;{$status[&#39;statistics&#39;][&#39;hit_rate&#39;]}%&quot;],</span>
</span><span id=__span-25-202><a id=__codelineno-25-202 name=__codelineno-25-202 href=#__codelineno-25-202></a><span class=x>                [&#39;Cached Scripts&#39;, &quot;{$status[&#39;statistics&#39;][&#39;num_cached_scripts&#39;]} / {$status[&#39;statistics&#39;][&#39;max_cached_scripts&#39;]}&quot;],</span>
</span><span id=__span-25-203><a id=__codelineno-25-203 name=__codelineno-25-203 href=#__codelineno-25-203></a><span class=x>                [&#39;Scripts Usage&#39;, &quot;{$status[&#39;statistics&#39;][&#39;scripts_usage_percent&#39;]}%&quot;],</span>
</span><span id=__span-25-204><a id=__codelineno-25-204 name=__codelineno-25-204 href=#__codelineno-25-204></a><span class=x>            ]</span>
</span><span id=__span-25-205><a id=__codelineno-25-205 name=__codelineno-25-205 href=#__codelineno-25-205></a><span class=x>        );</span>
</span><span id=__span-25-206><a id=__codelineno-25-206 name=__codelineno-25-206 href=#__codelineno-25-206></a>
</span><span id=__span-25-207><a id=__codelineno-25-207 name=__codelineno-25-207 href=#__codelineno-25-207></a><span class=x>        // Restarts</span>
</span><span id=__span-25-208><a id=__codelineno-25-208 name=__codelineno-25-208 href=#__codelineno-25-208></a><span class=x>        if ($status[&#39;statistics&#39;][&#39;oom_restarts&#39;] &gt; 0 || $status[&#39;statistics&#39;][&#39;manual_restarts&#39;] &gt; 0) {</span>
</span><span id=__span-25-209><a id=__codelineno-25-209 name=__codelineno-25-209 href=#__codelineno-25-209></a><span class=x>            $this-&gt;line(&#39;&lt;fg=red&gt;Restarts:&lt;/&gt;&#39;);</span>
</span><span id=__span-25-210><a id=__codelineno-25-210 name=__codelineno-25-210 href=#__codelineno-25-210></a><span class=x>            $this-&gt;table(</span>
</span><span id=__span-25-211><a id=__codelineno-25-211 name=__codelineno-25-211 href=#__codelineno-25-211></a><span class=x>                [&#39;Type&#39;, &#39;Count&#39;],</span>
</span><span id=__span-25-212><a id=__codelineno-25-212 name=__codelineno-25-212 href=#__codelineno-25-212></a><span class=x>                [</span>
</span><span id=__span-25-213><a id=__codelineno-25-213 name=__codelineno-25-213 href=#__codelineno-25-213></a><span class=x>                    [&#39;OOM&#39;, $status[&#39;statistics&#39;][&#39;oom_restarts&#39;]],</span>
</span><span id=__span-25-214><a id=__codelineno-25-214 name=__codelineno-25-214 href=#__codelineno-25-214></a><span class=x>                    [&#39;Manual&#39;, $status[&#39;statistics&#39;][&#39;manual_restarts&#39;]],</span>
</span><span id=__span-25-215><a id=__codelineno-25-215 name=__codelineno-25-215 href=#__codelineno-25-215></a><span class=x>                    [&#39;Hash&#39;, $status[&#39;statistics&#39;][&#39;hash_restarts&#39;]],</span>
</span><span id=__span-25-216><a id=__codelineno-25-216 name=__codelineno-25-216 href=#__codelineno-25-216></a><span class=x>                ]</span>
</span><span id=__span-25-217><a id=__codelineno-25-217 name=__codelineno-25-217 href=#__codelineno-25-217></a><span class=x>            );</span>
</span><span id=__span-25-218><a id=__codelineno-25-218 name=__codelineno-25-218 href=#__codelineno-25-218></a><span class=x>        }</span>
</span><span id=__span-25-219><a id=__codelineno-25-219 name=__codelineno-25-219 href=#__codelineno-25-219></a>
</span><span id=__span-25-220><a id=__codelineno-25-220 name=__codelineno-25-220 href=#__codelineno-25-220></a><span class=x>        // Health check</span>
</span><span id=__span-25-221><a id=__codelineno-25-221 name=__codelineno-25-221 href=#__codelineno-25-221></a><span class=x>        $health = $service-&gt;healthCheck();</span>
</span><span id=__span-25-222><a id=__codelineno-25-222 name=__codelineno-25-222 href=#__codelineno-25-222></a><span class=x>        $this-&gt;newLine();</span>
</span><span id=__span-25-223><a id=__codelineno-25-223 name=__codelineno-25-223 href=#__codelineno-25-223></a>
</span><span id=__span-25-224><a id=__codelineno-25-224 name=__codelineno-25-224 href=#__codelineno-25-224></a><span class=x>        if ($health[&#39;healthy&#39;]) {</span>
</span><span id=__span-25-225><a id=__codelineno-25-225 name=__codelineno-25-225 href=#__codelineno-25-225></a><span class=x>            $this-&gt;info(&#39;✓ OPcache is healthy&#39;);</span>
</span><span id=__span-25-226><a id=__codelineno-25-226 name=__codelineno-25-226 href=#__codelineno-25-226></a><span class=x>        } else {</span>
</span><span id=__span-25-227><a id=__codelineno-25-227 name=__codelineno-25-227 href=#__codelineno-25-227></a><span class=x>            $this-&gt;error(&#39;✗ OPcache has issues:&#39;);</span>
</span><span id=__span-25-228><a id=__codelineno-25-228 name=__codelineno-25-228 href=#__codelineno-25-228></a><span class=x>            foreach ($health[&#39;issues&#39;] as $issue) {</span>
</span><span id=__span-25-229><a id=__codelineno-25-229 name=__codelineno-25-229 href=#__codelineno-25-229></a><span class=x>                $this-&gt;line(&quot;  - {$issue}&quot;);</span>
</span><span id=__span-25-230><a id=__codelineno-25-230 name=__codelineno-25-230 href=#__codelineno-25-230></a><span class=x>            }</span>
</span><span id=__span-25-231><a id=__codelineno-25-231 name=__codelineno-25-231 href=#__codelineno-25-231></a><span class=x>        }</span>
</span><span id=__span-25-232><a id=__codelineno-25-232 name=__codelineno-25-232 href=#__codelineno-25-232></a>
</span><span id=__span-25-233><a id=__codelineno-25-233 name=__codelineno-25-233 href=#__codelineno-25-233></a><span class=x>        return 0;</span>
</span><span id=__span-25-234><a id=__codelineno-25-234 name=__codelineno-25-234 href=#__codelineno-25-234></a><span class=x>    }</span>
</span><span id=__span-25-235><a id=__codelineno-25-235 name=__codelineno-25-235 href=#__codelineno-25-235></a><span class=x>}</span>
</span><span id=__span-25-236><a id=__codelineno-25-236 name=__codelineno-25-236 href=#__codelineno-25-236></a>
</span><span id=__span-25-237><a id=__codelineno-25-237 name=__codelineno-25-237 href=#__codelineno-25-237></a><span class=x>// Controller для dashboard</span>
</span><span id=__span-25-238><a id=__codelineno-25-238 name=__codelineno-25-238 href=#__codelineno-25-238></a><span class=x>namespace App\Http\Controllers;</span>
</span><span id=__span-25-239><a id=__codelineno-25-239 name=__codelineno-25-239 href=#__codelineno-25-239></a>
</span><span id=__span-25-240><a id=__codelineno-25-240 name=__codelineno-25-240 href=#__codelineno-25-240></a><span class=x>use App\Services\OPcacheMonitoringService;</span>
</span><span id=__span-25-241><a id=__codelineno-25-241 name=__codelineno-25-241 href=#__codelineno-25-241></a>
</span><span id=__span-25-242><a id=__codelineno-25-242 name=__codelineno-25-242 href=#__codelineno-25-242></a><span class=x>class OPcacheController extends Controller</span>
</span><span id=__span-25-243><a id=__codelineno-25-243 name=__codelineno-25-243 href=#__codelineno-25-243></a><span class=x>{</span>
</span><span id=__span-25-244><a id=__codelineno-25-244 name=__codelineno-25-244 href=#__codelineno-25-244></a><span class=x>    public function __construct(</span>
</span><span id=__span-25-245><a id=__codelineno-25-245 name=__codelineno-25-245 href=#__codelineno-25-245></a><span class=x>        private OPcacheMonitoringService $service</span>
</span><span id=__span-25-246><a id=__codelineno-25-246 name=__codelineno-25-246 href=#__codelineno-25-246></a><span class=x>    ) {</span>
</span><span id=__span-25-247><a id=__codelineno-25-247 name=__codelineno-25-247 href=#__codelineno-25-247></a><span class=x>        $this-&gt;middleware(&#39;auth&#39;);</span>
</span><span id=__span-25-248><a id=__codelineno-25-248 name=__codelineno-25-248 href=#__codelineno-25-248></a><span class=x>    }</span>
</span><span id=__span-25-249><a id=__codelineno-25-249 name=__codelineno-25-249 href=#__codelineno-25-249></a>
</span><span id=__span-25-250><a id=__codelineno-25-250 name=__codelineno-25-250 href=#__codelineno-25-250></a><span class=x>    public function status()</span>
</span><span id=__span-25-251><a id=__codelineno-25-251 name=__codelineno-25-251 href=#__codelineno-25-251></a><span class=x>    {</span>
</span><span id=__span-25-252><a id=__codelineno-25-252 name=__codelineno-25-252 href=#__codelineno-25-252></a><span class=x>        return response()-&gt;json([</span>
</span><span id=__span-25-253><a id=__codelineno-25-253 name=__codelineno-25-253 href=#__codelineno-25-253></a><span class=x>            &#39;status&#39; =&gt; $this-&gt;service-&gt;getStatus(),</span>
</span><span id=__span-25-254><a id=__codelineno-25-254 name=__codelineno-25-254 href=#__codelineno-25-254></a><span class=x>            &#39;health&#39; =&gt; $this-&gt;service-&gt;healthCheck(),</span>
</span><span id=__span-25-255><a id=__codelineno-25-255 name=__codelineno-25-255 href=#__codelineno-25-255></a><span class=x>        ]);</span>
</span><span id=__span-25-256><a id=__codelineno-25-256 name=__codelineno-25-256 href=#__codelineno-25-256></a><span class=x>    }</span>
</span><span id=__span-25-257><a id=__codelineno-25-257 name=__codelineno-25-257 href=#__codelineno-25-257></a>
</span><span id=__span-25-258><a id=__codelineno-25-258 name=__codelineno-25-258 href=#__codelineno-25-258></a><span class=x>    public function clear()</span>
</span><span id=__span-25-259><a id=__codelineno-25-259 name=__codelineno-25-259 href=#__codelineno-25-259></a><span class=x>    {</span>
</span><span id=__span-25-260><a id=__codelineno-25-260 name=__codelineno-25-260 href=#__codelineno-25-260></a><span class=x>        if (function_exists(&#39;opcache_reset&#39;)) {</span>
</span><span id=__span-25-261><a id=__codelineno-25-261 name=__codelineno-25-261 href=#__codelineno-25-261></a><span class=x>            opcache_reset();</span>
</span><span id=__span-25-262><a id=__codelineno-25-262 name=__codelineno-25-262 href=#__codelineno-25-262></a><span class=x>            return response()-&gt;json([&#39;message&#39; =&gt; &#39;OPcache cleared&#39;]);</span>
</span><span id=__span-25-263><a id=__codelineno-25-263 name=__codelineno-25-263 href=#__codelineno-25-263></a><span class=x>        }</span>
</span><span id=__span-25-264><a id=__codelineno-25-264 name=__codelineno-25-264 href=#__codelineno-25-264></a>
</span><span id=__span-25-265><a id=__codelineno-25-265 name=__codelineno-25-265 href=#__codelineno-25-265></a><span class=x>        return response()-&gt;json([&#39;message&#39; =&gt; &#39;OPcache not available&#39;], 400);</span>
</span><span id=__span-25-266><a id=__codelineno-25-266 name=__codelineno-25-266 href=#__codelineno-25-266></a><span class=x>    }</span>
</span><span id=__span-25-267><a id=__codelineno-25-267 name=__codelineno-25-267 href=#__codelineno-25-267></a><span class=x>}</span>
</span></code></pre></div> </details> <h3 id=2-smart-opcache-preloading-generator>Задание 2: Smart OPcache Preloading Generator<a class=headerlink href=#2-smart-opcache-preloading-generator title="Permanent link">&para;</a></h3> <p>Создай сервис который автоматически генерирует preload.php файл на основе часто используемых классов.</p> <details> <summary>Решение</summary> <div class="language-php highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=x>namespace App\Services;</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=x>use Illuminate\Support\Facades\File;</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=x>class OPcachePreloadGenerator</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=x>{</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=x>    private array $classes = [];</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=x>    private string $basePath;</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=x>    public function __construct()</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=x>    {</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=x>        $this-&gt;basePath = base_path();</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=x>    }</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=x>    /**</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=x>     * Добавить класс для preload</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=x>     */</span>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=x>    public function addClass(string $class): self</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=x>    {</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=x>        $this-&gt;classes[] = $class;</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=x>        return $this;</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=x>    }</span>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=x>    /**</span>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=x>     * Добавить все классы из директории</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=x>     */</span>
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a><span class=x>    public function addDirectory(string $directory): self</span>
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=x>    {</span>
</span><span id=__span-26-29><a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=x>        $files = File::allFiles($directory);</span>
</span><span id=__span-26-30><a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a>
</span><span id=__span-26-31><a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=x>        foreach ($files as $file) {</span>
</span><span id=__span-26-32><a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a><span class=x>            if ($file-&gt;getExtension() === &#39;php&#39;) {</span>
</span><span id=__span-26-33><a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a><span class=x>                $this-&gt;addFileToPreload($file-&gt;getPathname());</span>
</span><span id=__span-26-34><a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a><span class=x>            }</span>
</span><span id=__span-26-35><a id=__codelineno-26-35 name=__codelineno-26-35 href=#__codelineno-26-35></a><span class=x>        }</span>
</span><span id=__span-26-36><a id=__codelineno-26-36 name=__codelineno-26-36 href=#__codelineno-26-36></a>
</span><span id=__span-26-37><a id=__codelineno-26-37 name=__codelineno-26-37 href=#__codelineno-26-37></a><span class=x>        return $this;</span>
</span><span id=__span-26-38><a id=__codelineno-26-38 name=__codelineno-26-38 href=#__codelineno-26-38></a><span class=x>    }</span>
</span><span id=__span-26-39><a id=__codelineno-26-39 name=__codelineno-26-39 href=#__codelineno-26-39></a>
</span><span id=__span-26-40><a id=__codelineno-26-40 name=__codelineno-26-40 href=#__codelineno-26-40></a><span class=x>    /**</span>
</span><span id=__span-26-41><a id=__codelineno-26-41 name=__codelineno-26-41 href=#__codelineno-26-41></a><span class=x>     * Добавить Laravel core классы</span>
</span><span id=__span-26-42><a id=__codelineno-26-42 name=__codelineno-26-42 href=#__codelineno-26-42></a><span class=x>     */</span>
</span><span id=__span-26-43><a id=__codelineno-26-43 name=__codelineno-26-43 href=#__codelineno-26-43></a><span class=x>    public function addLaravelCore(): self</span>
</span><span id=__span-26-44><a id=__codelineno-26-44 name=__codelineno-26-44 href=#__codelineno-26-44></a><span class=x>    {</span>
</span><span id=__span-26-45><a id=__codelineno-26-45 name=__codelineno-26-45 href=#__codelineno-26-45></a><span class=x>        $coreClasses = [</span>
</span><span id=__span-26-46><a id=__codelineno-26-46 name=__codelineno-26-46 href=#__codelineno-26-46></a><span class=x>            \Illuminate\Foundation\Application::class,</span>
</span><span id=__span-26-47><a id=__codelineno-26-47 name=__codelineno-26-47 href=#__codelineno-26-47></a><span class=x>            \Illuminate\Http\Request::class,</span>
</span><span id=__span-26-48><a id=__codelineno-26-48 name=__codelineno-26-48 href=#__codelineno-26-48></a><span class=x>            \Illuminate\Http\Response::class,</span>
</span><span id=__span-26-49><a id=__codelineno-26-49 name=__codelineno-26-49 href=#__codelineno-26-49></a><span class=x>            \Illuminate\Routing\Router::class,</span>
</span><span id=__span-26-50><a id=__codelineno-26-50 name=__codelineno-26-50 href=#__codelineno-26-50></a><span class=x>            \Illuminate\Support\Facades\Facade::class,</span>
</span><span id=__span-26-51><a id=__codelineno-26-51 name=__codelineno-26-51 href=#__codelineno-26-51></a><span class=x>            \Illuminate\Database\Eloquent\Model::class,</span>
</span><span id=__span-26-52><a id=__codelineno-26-52 name=__codelineno-26-52 href=#__codelineno-26-52></a><span class=x>            \Illuminate\Database\Eloquent\Builder::class,</span>
</span><span id=__span-26-53><a id=__codelineno-26-53 name=__codelineno-26-53 href=#__codelineno-26-53></a><span class=x>            \Illuminate\Support\Collection::class,</span>
</span><span id=__span-26-54><a id=__codelineno-26-54 name=__codelineno-26-54 href=#__codelineno-26-54></a><span class=x>        ];</span>
</span><span id=__span-26-55><a id=__codelineno-26-55 name=__codelineno-26-55 href=#__codelineno-26-55></a>
</span><span id=__span-26-56><a id=__codelineno-26-56 name=__codelineno-26-56 href=#__codelineno-26-56></a><span class=x>        foreach ($coreClasses as $class) {</span>
</span><span id=__span-26-57><a id=__codelineno-26-57 name=__codelineno-26-57 href=#__codelineno-26-57></a><span class=x>            $this-&gt;addClass($class);</span>
</span><span id=__span-26-58><a id=__codelineno-26-58 name=__codelineno-26-58 href=#__codelineno-26-58></a><span class=x>        }</span>
</span><span id=__span-26-59><a id=__codelineno-26-59 name=__codelineno-26-59 href=#__codelineno-26-59></a>
</span><span id=__span-26-60><a id=__codelineno-26-60 name=__codelineno-26-60 href=#__codelineno-26-60></a><span class=x>        return $this;</span>
</span><span id=__span-26-61><a id=__codelineno-26-61 name=__codelineno-26-61 href=#__codelineno-26-61></a><span class=x>    }</span>
</span><span id=__span-26-62><a id=__codelineno-26-62 name=__codelineno-26-62 href=#__codelineno-26-62></a>
</span><span id=__span-26-63><a id=__codelineno-26-63 name=__codelineno-26-63 href=#__codelineno-26-63></a><span class=x>    /**</span>
</span><span id=__span-26-64><a id=__codelineno-26-64 name=__codelineno-26-64 href=#__codelineno-26-64></a><span class=x>     * Добавить модели приложения</span>
</span><span id=__span-26-65><a id=__codelineno-26-65 name=__codelineno-26-65 href=#__codelineno-26-65></a><span class=x>     */</span>
</span><span id=__span-26-66><a id=__codelineno-26-66 name=__codelineno-26-66 href=#__codelineno-26-66></a><span class=x>    public function addModels(): self</span>
</span><span id=__span-26-67><a id=__codelineno-26-67 name=__codelineno-26-67 href=#__codelineno-26-67></a><span class=x>    {</span>
</span><span id=__span-26-68><a id=__codelineno-26-68 name=__codelineno-26-68 href=#__codelineno-26-68></a><span class=x>        return $this-&gt;addDirectory(app_path(&#39;Models&#39;));</span>
</span><span id=__span-26-69><a id=__codelineno-26-69 name=__codelineno-26-69 href=#__codelineno-26-69></a><span class=x>    }</span>
</span><span id=__span-26-70><a id=__codelineno-26-70 name=__codelineno-26-70 href=#__codelineno-26-70></a>
</span><span id=__span-26-71><a id=__codelineno-26-71 name=__codelineno-26-71 href=#__codelineno-26-71></a><span class=x>    /**</span>
</span><span id=__span-26-72><a id=__codelineno-26-72 name=__codelineno-26-72 href=#__codelineno-26-72></a><span class=x>     * Добавить контроллеры</span>
</span><span id=__span-26-73><a id=__codelineno-26-73 name=__codelineno-26-73 href=#__codelineno-26-73></a><span class=x>     */</span>
</span><span id=__span-26-74><a id=__codelineno-26-74 name=__codelineno-26-74 href=#__codelineno-26-74></a><span class=x>    public function addControllers(): self</span>
</span><span id=__span-26-75><a id=__codelineno-26-75 name=__codelineno-26-75 href=#__codelineno-26-75></a><span class=x>    {</span>
</span><span id=__span-26-76><a id=__codelineno-26-76 name=__codelineno-26-76 href=#__codelineno-26-76></a><span class=x>        return $this-&gt;addDirectory(app_path(&#39;Http/Controllers&#39;));</span>
</span><span id=__span-26-77><a id=__codelineno-26-77 name=__codelineno-26-77 href=#__codelineno-26-77></a><span class=x>    }</span>
</span><span id=__span-26-78><a id=__codelineno-26-78 name=__codelineno-26-78 href=#__codelineno-26-78></a>
</span><span id=__span-26-79><a id=__codelineno-26-79 name=__codelineno-26-79 href=#__codelineno-26-79></a><span class=x>    /**</span>
</span><span id=__span-26-80><a id=__codelineno-26-80 name=__codelineno-26-80 href=#__codelineno-26-80></a><span class=x>     * Добавить middleware</span>
</span><span id=__span-26-81><a id=__codelineno-26-81 name=__codelineno-26-81 href=#__codelineno-26-81></a><span class=x>     */</span>
</span><span id=__span-26-82><a id=__codelineno-26-82 name=__codelineno-26-82 href=#__codelineno-26-82></a><span class=x>    public function addMiddleware(): self</span>
</span><span id=__span-26-83><a id=__codelineno-26-83 name=__codelineno-26-83 href=#__codelineno-26-83></a><span class=x>    {</span>
</span><span id=__span-26-84><a id=__codelineno-26-84 name=__codelineno-26-84 href=#__codelineno-26-84></a><span class=x>        return $this-&gt;addDirectory(app_path(&#39;Http/Middleware&#39;));</span>
</span><span id=__span-26-85><a id=__codelineno-26-85 name=__codelineno-26-85 href=#__codelineno-26-85></a><span class=x>    }</span>
</span><span id=__span-26-86><a id=__codelineno-26-86 name=__codelineno-26-86 href=#__codelineno-26-86></a>
</span><span id=__span-26-87><a id=__codelineno-26-87 name=__codelineno-26-87 href=#__codelineno-26-87></a><span class=x>    /**</span>
</span><span id=__span-26-88><a id=__codelineno-26-88 name=__codelineno-26-88 href=#__codelineno-26-88></a><span class=x>     * Сгенерировать preload.php файл</span>
</span><span id=__span-26-89><a id=__codelineno-26-89 name=__codelineno-26-89 href=#__codelineno-26-89></a><span class=x>     */</span>
</span><span id=__span-26-90><a id=__codelineno-26-90 name=__codelineno-26-90 href=#__codelineno-26-90></a><span class=x>    public function generate(string $outputPath = null): string</span>
</span><span id=__span-26-91><a id=__codelineno-26-91 name=__codelineno-26-91 href=#__codelineno-26-91></a><span class=x>    {</span>
</span><span id=__span-26-92><a id=__codelineno-26-92 name=__codelineno-26-92 href=#__codelineno-26-92></a><span class=x>        $outputPath = $outputPath ?? $this-&gt;basePath . &#39;/bootstrap/cache/preload.php&#39;;</span>
</span><span id=__span-26-93><a id=__codelineno-26-93 name=__codelineno-26-93 href=#__codelineno-26-93></a>
</span><span id=__span-26-94><a id=__codelineno-26-94 name=__codelineno-26-94 href=#__codelineno-26-94></a><span class=x>        $content = $this-&gt;generateContent();</span>
</span><span id=__span-26-95><a id=__codelineno-26-95 name=__codelineno-26-95 href=#__codelineno-26-95></a>
</span><span id=__span-26-96><a id=__codelineno-26-96 name=__codelineno-26-96 href=#__codelineno-26-96></a><span class=x>        File::put($outputPath, $content);</span>
</span><span id=__span-26-97><a id=__codelineno-26-97 name=__codelineno-26-97 href=#__codelineno-26-97></a>
</span><span id=__span-26-98><a id=__codelineno-26-98 name=__codelineno-26-98 href=#__codelineno-26-98></a><span class=x>        return $outputPath;</span>
</span><span id=__span-26-99><a id=__codelineno-26-99 name=__codelineno-26-99 href=#__codelineno-26-99></a><span class=x>    }</span>
</span><span id=__span-26-100><a id=__codelineno-26-100 name=__codelineno-26-100 href=#__codelineno-26-100></a>
</span><span id=__span-26-101><a id=__codelineno-26-101 name=__codelineno-26-101 href=#__codelineno-26-101></a><span class=x>    private function generateContent(): string</span>
</span><span id=__span-26-102><a id=__codelineno-26-102 name=__codelineno-26-102 href=#__codelineno-26-102></a><span class=x>    {</span>
</span><span id=__span-26-103><a id=__codelineno-26-103 name=__codelineno-26-103 href=#__codelineno-26-103></a><span class=x>        $files = $this-&gt;resolveFiles();</span>
</span><span id=__span-26-104><a id=__codelineno-26-104 name=__codelineno-26-104 href=#__codelineno-26-104></a>
</span><span id=__span-26-105><a id=__codelineno-26-105 name=__codelineno-26-105 href=#__codelineno-26-105></a><span class=x>        $content = &quot;</span><span class=cp>&lt;?php</span><span class=nx>\n\n</span><span class=s2>&quot;;</span>
</span><span id=__span-26-106><a id=__codelineno-26-106 name=__codelineno-26-106 href=#__codelineno-26-106></a><span class=s2>        </span><span class=si>$content</span><span class=s2> .= &quot;</span><span class=c1>// Auto-generated OPcache preload file\n&quot;;</span>
</span><span id=__span-26-107><a id=__codelineno-26-107 name=__codelineno-26-107 href=#__codelineno-26-107></a>        <span class=nv>$content</span> <span class=o>.=</span> <span class=s2>&quot;// Generated at: &quot;</span> <span class=o>.</span> <span class=nb>date</span><span class=p>(</span><span class=s1>&#39;Y-m-d H:i:s&#39;</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>;</span>
</span><span id=__span-26-108><a id=__codelineno-26-108 name=__codelineno-26-108 href=#__codelineno-26-108></a>
</span><span id=__span-26-109><a id=__codelineno-26-109 name=__codelineno-26-109 href=#__codelineno-26-109></a>        <span class=nv>$content</span> <span class=o>.=</span> <span class=s2>&quot;// Load Composer autoloader</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
</span><span id=__span-26-110><a id=__codelineno-26-110 name=__codelineno-26-110 href=#__codelineno-26-110></a>        <span class=nv>$content</span> <span class=o>.=</span> <span class=s2>&quot;require __DIR__ . &#39;/../../vendor/autoload.php&#39;;</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>;</span>
</span><span id=__span-26-111><a id=__codelineno-26-111 name=__codelineno-26-111 href=#__codelineno-26-111></a>
</span><span id=__span-26-112><a id=__codelineno-26-112 name=__codelineno-26-112 href=#__codelineno-26-112></a>        <span class=nv>$content</span> <span class=o>.=</span> <span class=s2>&quot;// Preload files</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
</span><span id=__span-26-113><a id=__codelineno-26-113 name=__codelineno-26-113 href=#__codelineno-26-113></a>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$files</span> <span class=k>as</span> <span class=nv>$file</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-26-114><a id=__codelineno-26-114 name=__codelineno-26-114 href=#__codelineno-26-114></a>            <span class=nv>$content</span> <span class=o>.=</span> <span class=s2>&quot;opcache_compile_file(&#39;</span><span class=si>{</span><span class=nv>$file</span><span class=si>}</span><span class=s2>&#39;);</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
</span><span id=__span-26-115><a id=__codelineno-26-115 name=__codelineno-26-115 href=#__codelineno-26-115></a>        <span class=p>}</span>
</span><span id=__span-26-116><a id=__codelineno-26-116 name=__codelineno-26-116 href=#__codelineno-26-116></a>
</span><span id=__span-26-117><a id=__codelineno-26-117 name=__codelineno-26-117 href=#__codelineno-26-117></a>        <span class=nv>$content</span> <span class=o>.=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>// Total files preloaded: &quot;</span> <span class=o>.</span> <span class=nb>count</span><span class=p>(</span><span class=nv>$files</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>;</span>
</span><span id=__span-26-118><a id=__codelineno-26-118 name=__codelineno-26-118 href=#__codelineno-26-118></a>
</span><span id=__span-26-119><a id=__codelineno-26-119 name=__codelineno-26-119 href=#__codelineno-26-119></a>        <span class=k>return</span> <span class=nv>$content</span><span class=p>;</span>
</span><span id=__span-26-120><a id=__codelineno-26-120 name=__codelineno-26-120 href=#__codelineno-26-120></a>    <span class=p>}</span>
</span><span id=__span-26-121><a id=__codelineno-26-121 name=__codelineno-26-121 href=#__codelineno-26-121></a>
</span><span id=__span-26-122><a id=__codelineno-26-122 name=__codelineno-26-122 href=#__codelineno-26-122></a>    <span class=k>private</span> <span class=k>function</span> <span class=nf>resolveFiles</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span><span id=__span-26-123><a id=__codelineno-26-123 name=__codelineno-26-123 href=#__codelineno-26-123></a>    <span class=p>{</span>
</span><span id=__span-26-124><a id=__codelineno-26-124 name=__codelineno-26-124 href=#__codelineno-26-124></a>        <span class=nv>$files</span> <span class=o>=</span> <span class=p>[];</span>
</span><span id=__span-26-125><a id=__codelineno-26-125 name=__codelineno-26-125 href=#__codelineno-26-125></a>
</span><span id=__span-26-126><a id=__codelineno-26-126 name=__codelineno-26-126 href=#__codelineno-26-126></a>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>classes</span> <span class=k>as</span> <span class=nv>$class</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-26-127><a id=__codelineno-26-127 name=__codelineno-26-127 href=#__codelineno-26-127></a>            <span class=k>try</span> <span class=p>{</span>
</span><span id=__span-26-128><a id=__codelineno-26-128 name=__codelineno-26-128 href=#__codelineno-26-128></a>                <span class=nv>$reflection</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>\ReflectionClass</span><span class=p>(</span><span class=nv>$class</span><span class=p>);</span>
</span><span id=__span-26-129><a id=__codelineno-26-129 name=__codelineno-26-129 href=#__codelineno-26-129></a>                <span class=nv>$file</span> <span class=o>=</span> <span class=nv>$reflection</span><span class=o>-&gt;</span><span class=na>getFileName</span><span class=p>();</span>
</span><span id=__span-26-130><a id=__codelineno-26-130 name=__codelineno-26-130 href=#__codelineno-26-130></a>
</span><span id=__span-26-131><a id=__codelineno-26-131 name=__codelineno-26-131 href=#__codelineno-26-131></a>                <span class=k>if</span> <span class=p>(</span><span class=nv>$file</span> <span class=o>&amp;&amp;</span> <span class=nb>file_exists</span><span class=p>(</span><span class=nv>$file</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-132><a id=__codelineno-26-132 name=__codelineno-26-132 href=#__codelineno-26-132></a>                    <span class=nv>$files</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$file</span><span class=p>;</span>
</span><span id=__span-26-133><a id=__codelineno-26-133 name=__codelineno-26-133 href=#__codelineno-26-133></a>                <span class=p>}</span>
</span><span id=__span-26-134><a id=__codelineno-26-134 name=__codelineno-26-134 href=#__codelineno-26-134></a>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>\ReflectionException</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-26-135><a id=__codelineno-26-135 name=__codelineno-26-135 href=#__codelineno-26-135></a>                <span class=c1>// Класс не найден</span>
</span><span id=__span-26-136><a id=__codelineno-26-136 name=__codelineno-26-136 href=#__codelineno-26-136></a>                <span class=k>continue</span><span class=p>;</span>
</span><span id=__span-26-137><a id=__codelineno-26-137 name=__codelineno-26-137 href=#__codelineno-26-137></a>            <span class=p>}</span>
</span><span id=__span-26-138><a id=__codelineno-26-138 name=__codelineno-26-138 href=#__codelineno-26-138></a>        <span class=p>}</span>
</span><span id=__span-26-139><a id=__codelineno-26-139 name=__codelineno-26-139 href=#__codelineno-26-139></a>
</span><span id=__span-26-140><a id=__codelineno-26-140 name=__codelineno-26-140 href=#__codelineno-26-140></a>        <span class=k>return</span> <span class=nb>array_unique</span><span class=p>(</span><span class=nv>$files</span><span class=p>);</span>
</span><span id=__span-26-141><a id=__codelineno-26-141 name=__codelineno-26-141 href=#__codelineno-26-141></a>    <span class=p>}</span>
</span><span id=__span-26-142><a id=__codelineno-26-142 name=__codelineno-26-142 href=#__codelineno-26-142></a>
</span><span id=__span-26-143><a id=__codelineno-26-143 name=__codelineno-26-143 href=#__codelineno-26-143></a>    <span class=k>private</span> <span class=k>function</span> <span class=nf>addFileToPreload</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$filepath</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span>
</span><span id=__span-26-144><a id=__codelineno-26-144 name=__codelineno-26-144 href=#__codelineno-26-144></a>    <span class=p>{</span>
</span><span id=__span-26-145><a id=__codelineno-26-145 name=__codelineno-26-145 href=#__codelineno-26-145></a>        <span class=c1>// Попытаться определить класс из файла</span>
</span><span id=__span-26-146><a id=__codelineno-26-146 name=__codelineno-26-146 href=#__codelineno-26-146></a>        <span class=nv>$content</span> <span class=o>=</span> <span class=nb>file_get_contents</span><span class=p>(</span><span class=nv>$filepath</span><span class=p>);</span>
</span><span id=__span-26-147><a id=__codelineno-26-147 name=__codelineno-26-147 href=#__codelineno-26-147></a>
</span><span id=__span-26-148><a id=__codelineno-26-148 name=__codelineno-26-148 href=#__codelineno-26-148></a>        <span class=c1>// Простой regex для namespace и class</span>
</span><span id=__span-26-149><a id=__codelineno-26-149 name=__codelineno-26-149 href=#__codelineno-26-149></a>        <span class=k>if</span> <span class=p>(</span><span class=nb>preg_match</span><span class=p>(</span><span class=s1>&#39;/namespace\s+([^;]+);/&#39;</span><span class=p>,</span> <span class=nv>$content</span><span class=p>,</span> <span class=nv>$namespaceMatch</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-150><a id=__codelineno-26-150 name=__codelineno-26-150 href=#__codelineno-26-150></a>            <span class=nv>$namespace</span> <span class=o>=</span> <span class=nv>$namespaceMatch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span><span id=__span-26-151><a id=__codelineno-26-151 name=__codelineno-26-151 href=#__codelineno-26-151></a>
</span><span id=__span-26-152><a id=__codelineno-26-152 name=__codelineno-26-152 href=#__codelineno-26-152></a>            <span class=k>if</span> <span class=p>(</span><span class=nb>preg_match</span><span class=p>(</span><span class=s1>&#39;/class\s+(\w+)/&#39;</span><span class=p>,</span> <span class=nv>$content</span><span class=p>,</span> <span class=nv>$classMatch</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-153><a id=__codelineno-26-153 name=__codelineno-26-153 href=#__codelineno-26-153></a>                <span class=nv>$className</span> <span class=o>=</span> <span class=nv>$namespace</span> <span class=o>.</span> <span class=s1>&#39;\\&#39;</span> <span class=o>.</span> <span class=nv>$classMatch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span><span id=__span-26-154><a id=__codelineno-26-154 name=__codelineno-26-154 href=#__codelineno-26-154></a>                <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>addClass</span><span class=p>(</span><span class=nv>$className</span><span class=p>);</span>
</span><span id=__span-26-155><a id=__codelineno-26-155 name=__codelineno-26-155 href=#__codelineno-26-155></a>            <span class=p>}</span>
</span><span id=__span-26-156><a id=__codelineno-26-156 name=__codelineno-26-156 href=#__codelineno-26-156></a>        <span class=p>}</span>
</span><span id=__span-26-157><a id=__codelineno-26-157 name=__codelineno-26-157 href=#__codelineno-26-157></a>    <span class=p>}</span>
</span><span id=__span-26-158><a id=__codelineno-26-158 name=__codelineno-26-158 href=#__codelineno-26-158></a><span class=p>}</span>
</span><span id=__span-26-159><a id=__codelineno-26-159 name=__codelineno-26-159 href=#__codelineno-26-159></a>
</span><span id=__span-26-160><a id=__codelineno-26-160 name=__codelineno-26-160 href=#__codelineno-26-160></a><span class=c1>// Artisan Command</span>
</span><span id=__span-26-161><a id=__codelineno-26-161 name=__codelineno-26-161 href=#__codelineno-26-161></a><span class=k>namespace</span> <span class=nx>App\Console\Commands</span><span class=p>;</span>
</span><span id=__span-26-162><a id=__codelineno-26-162 name=__codelineno-26-162 href=#__codelineno-26-162></a>
</span><span id=__span-26-163><a id=__codelineno-26-163 name=__codelineno-26-163 href=#__codelineno-26-163></a><span class=k>use</span> <span class=nx>App\Services\OPcachePreloadGenerator</span><span class=p>;</span>
</span><span id=__span-26-164><a id=__codelineno-26-164 name=__codelineno-26-164 href=#__codelineno-26-164></a><span class=k>use</span> <span class=nx>Illuminate\Console\Command</span><span class=p>;</span>
</span><span id=__span-26-165><a id=__codelineno-26-165 name=__codelineno-26-165 href=#__codelineno-26-165></a>
</span><span id=__span-26-166><a id=__codelineno-26-166 name=__codelineno-26-166 href=#__codelineno-26-166></a><span class=k>class</span> <span class=nc>GenerateOPcachePreloadCommand</span> <span class=k>extends</span> <span class=nx>Command</span>
</span><span id=__span-26-167><a id=__codelineno-26-167 name=__codelineno-26-167 href=#__codelineno-26-167></a><span class=p>{</span>
</span><span id=__span-26-168><a id=__codelineno-26-168 name=__codelineno-26-168 href=#__codelineno-26-168></a>    <span class=k>protected</span> <span class=nv>$signature</span> <span class=o>=</span> <span class=s1>&#39;opcache:generate-preload</span>
</span><span id=__span-26-169><a id=__codelineno-26-169 name=__codelineno-26-169 href=#__codelineno-26-169></a><span class=s1>                            {--core : Include Laravel core}</span>
</span><span id=__span-26-170><a id=__codelineno-26-170 name=__codelineno-26-170 href=#__codelineno-26-170></a><span class=s1>                            {--models : Include models}</span>
</span><span id=__span-26-171><a id=__codelineno-26-171 name=__codelineno-26-171 href=#__codelineno-26-171></a><span class=s1>                            {--controllers : Include controllers}</span>
</span><span id=__span-26-172><a id=__codelineno-26-172 name=__codelineno-26-172 href=#__codelineno-26-172></a><span class=s1>                            {--middleware : Include middleware}</span>
</span><span id=__span-26-173><a id=__codelineno-26-173 name=__codelineno-26-173 href=#__codelineno-26-173></a><span class=s1>                            {--all : Include everything}&#39;</span><span class=p>;</span>
</span><span id=__span-26-174><a id=__codelineno-26-174 name=__codelineno-26-174 href=#__codelineno-26-174></a>
</span><span id=__span-26-175><a id=__codelineno-26-175 name=__codelineno-26-175 href=#__codelineno-26-175></a>    <span class=k>protected</span> <span class=nv>$description</span> <span class=o>=</span> <span class=s1>&#39;Generate OPcache preload file&#39;</span><span class=p>;</span>
</span><span id=__span-26-176><a id=__codelineno-26-176 name=__codelineno-26-176 href=#__codelineno-26-176></a>
</span><span id=__span-26-177><a id=__codelineno-26-177 name=__codelineno-26-177 href=#__codelineno-26-177></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>OPcachePreloadGenerator</span> <span class=nv>$generator</span><span class=p>)</span>
</span><span id=__span-26-178><a id=__codelineno-26-178 name=__codelineno-26-178 href=#__codelineno-26-178></a>    <span class=p>{</span>
</span><span id=__span-26-179><a id=__codelineno-26-179 name=__codelineno-26-179 href=#__codelineno-26-179></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>info</span><span class=p>(</span><span class=s1>&#39;Generating OPcache preload file...&#39;</span><span class=p>);</span>
</span><span id=__span-26-180><a id=__codelineno-26-180 name=__codelineno-26-180 href=#__codelineno-26-180></a>
</span><span id=__span-26-181><a id=__codelineno-26-181 name=__codelineno-26-181 href=#__codelineno-26-181></a>        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>option</span><span class=p>(</span><span class=s1>&#39;all&#39;</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-182><a id=__codelineno-26-182 name=__codelineno-26-182 href=#__codelineno-26-182></a>            <span class=nv>$generator</span><span class=o>-&gt;</span><span class=na>addLaravelCore</span><span class=p>()</span>
</span><span id=__span-26-183><a id=__codelineno-26-183 name=__codelineno-26-183 href=#__codelineno-26-183></a>                <span class=o>-&gt;</span><span class=na>addModels</span><span class=p>()</span>
</span><span id=__span-26-184><a id=__codelineno-26-184 name=__codelineno-26-184 href=#__codelineno-26-184></a>                <span class=o>-&gt;</span><span class=na>addControllers</span><span class=p>()</span>
</span><span id=__span-26-185><a id=__codelineno-26-185 name=__codelineno-26-185 href=#__codelineno-26-185></a>                <span class=o>-&gt;</span><span class=na>addMiddleware</span><span class=p>();</span>
</span><span id=__span-26-186><a id=__codelineno-26-186 name=__codelineno-26-186 href=#__codelineno-26-186></a>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span><span id=__span-26-187><a id=__codelineno-26-187 name=__codelineno-26-187 href=#__codelineno-26-187></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>option</span><span class=p>(</span><span class=s1>&#39;core&#39;</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-188><a id=__codelineno-26-188 name=__codelineno-26-188 href=#__codelineno-26-188></a>                <span class=nv>$generator</span><span class=o>-&gt;</span><span class=na>addLaravelCore</span><span class=p>();</span>
</span><span id=__span-26-189><a id=__codelineno-26-189 name=__codelineno-26-189 href=#__codelineno-26-189></a>                <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>line</span><span class=p>(</span><span class=s1>&#39;✓ Added Laravel core classes&#39;</span><span class=p>);</span>
</span><span id=__span-26-190><a id=__codelineno-26-190 name=__codelineno-26-190 href=#__codelineno-26-190></a>            <span class=p>}</span>
</span><span id=__span-26-191><a id=__codelineno-26-191 name=__codelineno-26-191 href=#__codelineno-26-191></a>
</span><span id=__span-26-192><a id=__codelineno-26-192 name=__codelineno-26-192 href=#__codelineno-26-192></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>option</span><span class=p>(</span><span class=s1>&#39;models&#39;</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-193><a id=__codelineno-26-193 name=__codelineno-26-193 href=#__codelineno-26-193></a>                <span class=nv>$generator</span><span class=o>-&gt;</span><span class=na>addModels</span><span class=p>();</span>
</span><span id=__span-26-194><a id=__codelineno-26-194 name=__codelineno-26-194 href=#__codelineno-26-194></a>                <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>line</span><span class=p>(</span><span class=s1>&#39;✓ Added models&#39;</span><span class=p>);</span>
</span><span id=__span-26-195><a id=__codelineno-26-195 name=__codelineno-26-195 href=#__codelineno-26-195></a>            <span class=p>}</span>
</span><span id=__span-26-196><a id=__codelineno-26-196 name=__codelineno-26-196 href=#__codelineno-26-196></a>
</span><span id=__span-26-197><a id=__codelineno-26-197 name=__codelineno-26-197 href=#__codelineno-26-197></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>option</span><span class=p>(</span><span class=s1>&#39;controllers&#39;</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-198><a id=__codelineno-26-198 name=__codelineno-26-198 href=#__codelineno-26-198></a>                <span class=nv>$generator</span><span class=o>-&gt;</span><span class=na>addControllers</span><span class=p>();</span>
</span><span id=__span-26-199><a id=__codelineno-26-199 name=__codelineno-26-199 href=#__codelineno-26-199></a>                <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>line</span><span class=p>(</span><span class=s1>&#39;✓ Added controllers&#39;</span><span class=p>);</span>
</span><span id=__span-26-200><a id=__codelineno-26-200 name=__codelineno-26-200 href=#__codelineno-26-200></a>            <span class=p>}</span>
</span><span id=__span-26-201><a id=__codelineno-26-201 name=__codelineno-26-201 href=#__codelineno-26-201></a>
</span><span id=__span-26-202><a id=__codelineno-26-202 name=__codelineno-26-202 href=#__codelineno-26-202></a>            <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>option</span><span class=p>(</span><span class=s1>&#39;middleware&#39;</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-26-203><a id=__codelineno-26-203 name=__codelineno-26-203 href=#__codelineno-26-203></a>                <span class=nv>$generator</span><span class=o>-&gt;</span><span class=na>addMiddleware</span><span class=p>();</span>
</span><span id=__span-26-204><a id=__codelineno-26-204 name=__codelineno-26-204 href=#__codelineno-26-204></a>                <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>line</span><span class=p>(</span><span class=s1>&#39;✓ Added middleware&#39;</span><span class=p>);</span>
</span><span id=__span-26-205><a id=__codelineno-26-205 name=__codelineno-26-205 href=#__codelineno-26-205></a>            <span class=p>}</span>
</span><span id=__span-26-206><a id=__codelineno-26-206 name=__codelineno-26-206 href=#__codelineno-26-206></a>        <span class=p>}</span>
</span><span id=__span-26-207><a id=__codelineno-26-207 name=__codelineno-26-207 href=#__codelineno-26-207></a>
</span><span id=__span-26-208><a id=__codelineno-26-208 name=__codelineno-26-208 href=#__codelineno-26-208></a>        <span class=nv>$outputPath</span> <span class=o>=</span> <span class=nv>$generator</span><span class=o>-&gt;</span><span class=na>generate</span><span class=p>();</span>
</span><span id=__span-26-209><a id=__codelineno-26-209 name=__codelineno-26-209 href=#__codelineno-26-209></a>
</span><span id=__span-26-210><a id=__codelineno-26-210 name=__codelineno-26-210 href=#__codelineno-26-210></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>info</span><span class=p>(</span><span class=s2>&quot;Preload file generated: </span><span class=si>{</span><span class=nv>$outputPath</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>);</span>
</span><span id=__span-26-211><a id=__codelineno-26-211 name=__codelineno-26-211 href=#__codelineno-26-211></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>newLine</span><span class=p>();</span>
</span><span id=__span-26-212><a id=__codelineno-26-212 name=__codelineno-26-212 href=#__codelineno-26-212></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>line</span><span class=p>(</span><span class=s1>&#39;Add to php.ini:&#39;</span><span class=p>);</span>
</span><span id=__span-26-213><a id=__codelineno-26-213 name=__codelineno-26-213 href=#__codelineno-26-213></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>line</span><span class=p>(</span><span class=s2>&quot;opcache.preload=</span><span class=si>{</span><span class=nv>$outputPath</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>);</span>
</span><span id=__span-26-214><a id=__codelineno-26-214 name=__codelineno-26-214 href=#__codelineno-26-214></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>line</span><span class=p>(</span><span class=s1>&#39;opcache.preload_user=www-data&#39;</span><span class=p>);</span>
</span><span id=__span-26-215><a id=__codelineno-26-215 name=__codelineno-26-215 href=#__codelineno-26-215></a>
</span><span id=__span-26-216><a id=__codelineno-26-216 name=__codelineno-26-216 href=#__codelineno-26-216></a>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span><span id=__span-26-217><a id=__codelineno-26-217 name=__codelineno-26-217 href=#__codelineno-26-217></a>    <span class=p>}</span>
</span><span id=__span-26-218><a id=__codelineno-26-218 name=__codelineno-26-218 href=#__codelineno-26-218></a><span class=p>}</span>
</span><span id=__span-26-219><a id=__codelineno-26-219 name=__codelineno-26-219 href=#__codelineno-26-219></a>
</span><span id=__span-26-220><a id=__codelineno-26-220 name=__codelineno-26-220 href=#__codelineno-26-220></a><span class=c1>// Service Provider для регистрации</span>
</span><span id=__span-26-221><a id=__codelineno-26-221 name=__codelineno-26-221 href=#__codelineno-26-221></a><span class=k>namespace</span> <span class=nx>App\Providers</span><span class=p>;</span>
</span><span id=__span-26-222><a id=__codelineno-26-222 name=__codelineno-26-222 href=#__codelineno-26-222></a>
</span><span id=__span-26-223><a id=__codelineno-26-223 name=__codelineno-26-223 href=#__codelineno-26-223></a><span class=k>use</span> <span class=nx>App\Services\OPcachePreloadGenerator</span><span class=p>;</span>
</span><span id=__span-26-224><a id=__codelineno-26-224 name=__codelineno-26-224 href=#__codelineno-26-224></a><span class=k>use</span> <span class=nx>Illuminate\Support\ServiceProvider</span><span class=p>;</span>
</span><span id=__span-26-225><a id=__codelineno-26-225 name=__codelineno-26-225 href=#__codelineno-26-225></a>
</span><span id=__span-26-226><a id=__codelineno-26-226 name=__codelineno-26-226 href=#__codelineno-26-226></a><span class=k>class</span> <span class=nc>OPcacheServiceProvider</span> <span class=k>extends</span> <span class=nx>ServiceProvider</span>
</span><span id=__span-26-227><a id=__codelineno-26-227 name=__codelineno-26-227 href=#__codelineno-26-227></a><span class=p>{</span>
</span><span id=__span-26-228><a id=__codelineno-26-228 name=__codelineno-26-228 href=#__codelineno-26-228></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>register</span><span class=p>()</span>
</span><span id=__span-26-229><a id=__codelineno-26-229 name=__codelineno-26-229 href=#__codelineno-26-229></a>    <span class=p>{</span>
</span><span id=__span-26-230><a id=__codelineno-26-230 name=__codelineno-26-230 href=#__codelineno-26-230></a>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>singleton</span><span class=p>(</span><span class=nx>OPcachePreloadGenerator</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span><span id=__span-26-231><a id=__codelineno-26-231 name=__codelineno-26-231 href=#__codelineno-26-231></a>    <span class=p>}</span>
</span><span id=__span-26-232><a id=__codelineno-26-232 name=__codelineno-26-232 href=#__codelineno-26-232></a>
</span><span id=__span-26-233><a id=__codelineno-26-233 name=__codelineno-26-233 href=#__codelineno-26-233></a>    <span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>()</span>
</span><span id=__span-26-234><a id=__codelineno-26-234 name=__codelineno-26-234 href=#__codelineno-26-234></a>    <span class=p>{</span>
</span><span id=__span-26-235><a id=__codelineno-26-235 name=__codelineno-26-235 href=#__codelineno-26-235></a>        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>runningInConsole</span><span class=p>())</span> <span class=p>{</span>
</span><span id=__span-26-236><a id=__codelineno-26-236 name=__codelineno-26-236 href=#__codelineno-26-236></a>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>commands</span><span class=p>([</span>
</span><span id=__span-26-237><a id=__codelineno-26-237 name=__codelineno-26-237 href=#__codelineno-26-237></a>                <span class=nx>\App\Console\Commands\GenerateOPcachePreloadCommand</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span><span id=__span-26-238><a id=__codelineno-26-238 name=__codelineno-26-238 href=#__codelineno-26-238></a>            <span class=p>]);</span>
</span><span id=__span-26-239><a id=__codelineno-26-239 name=__codelineno-26-239 href=#__codelineno-26-239></a>        <span class=p>}</span>
</span><span id=__span-26-240><a id=__codelineno-26-240 name=__codelineno-26-240 href=#__codelineno-26-240></a>    <span class=p>}</span>
</span><span id=__span-26-241><a id=__codelineno-26-241 name=__codelineno-26-241 href=#__codelineno-26-241></a><span class=p>}</span>
</span></code></pre></div> </details> <h3 id=3-automated-deploy-with-opcache-management>Задание 3: Automated Deploy with OPcache Management<a class=headerlink href=#3-automated-deploy-with-opcache-management title="Permanent link">&para;</a></h3> <p>Создай deploy script который автоматически управляет OPcache: warm up после deploy, monitoring, rollback при проблемах.</p> <details> <summary>Решение</summary> <div class="language-php highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=x>namespace App\Services;</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=x>use Illuminate\Support\Facades\Http;</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=x>use Illuminate\Support\Facades\Log;</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=x>class DeployOPcacheManager</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=x>{</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=x>    private string $appUrl;</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=x>    private array $servers;</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=x>    public function __construct()</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=x>    {</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=x>        $this-&gt;appUrl = config(&#39;app.url&#39;);</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=x>        $this-&gt;servers = config(&#39;deploy.servers&#39;, []);</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=x>    }</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=x>    /**</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=x>     * Pre-deploy: сохранить метрики</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=x>     */</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=x>    public function preDeploy(): array</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=x>    {</span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=x>        $this-&gt;log(&#39;Starting pre-deploy OPcache check...&#39;);</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=x>        $metrics = [];</span>
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a>
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a><span class=x>        foreach ($this-&gt;servers as $server) {</span>
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a><span class=x>            $status = $this-&gt;getServerOPcacheStatus($server);</span>
</span><span id=__span-27-28><a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a><span class=x>            $metrics[$server] = $status;</span>
</span><span id=__span-27-29><a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a>
</span><span id=__span-27-30><a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a><span class=x>            $this-&gt;log(&quot;Server {$server}: Hit Rate = {$status[&#39;hit_rate&#39;]}%&quot;);</span>
</span><span id=__span-27-31><a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a><span class=x>        }</span>
</span><span id=__span-27-32><a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a>
</span><span id=__span-27-33><a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a><span class=x>        // Сохранить метрики для сравнения</span>
</span><span id=__span-27-34><a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a><span class=x>        cache()-&gt;put(&#39;deploy:opcache:pre_metrics&#39;, $metrics, 3600);</span>
</span><span id=__span-27-35><a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a>
</span><span id=__span-27-36><a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a><span class=x>        return $metrics;</span>
</span><span id=__span-27-37><a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a><span class=x>    }</span>
</span><span id=__span-27-38><a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a>
</span><span id=__span-27-39><a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a><span class=x>    /**</span>
</span><span id=__span-27-40><a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a><span class=x>     * Post-deploy: clear OPcache на всех серверах</span>
</span><span id=__span-27-41><a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a><span class=x>     */</span>
</span><span id=__span-27-42><a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a><span class=x>    public function postDeploy(): bool</span>
</span><span id=__span-27-43><a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a><span class=x>    {</span>
</span><span id=__span-27-44><a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a><span class=x>        $this-&gt;log(&#39;Clearing OPcache on all servers...&#39;);</span>
</span><span id=__span-27-45><a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a>
</span><span id=__span-27-46><a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a><span class=x>        $results = [];</span>
</span><span id=__span-27-47><a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a>
</span><span id=__span-27-48><a id=__codelineno-27-48 name=__codelineno-27-48 href=#__codelineno-27-48></a><span class=x>        foreach ($this-&gt;servers as $server) {</span>
</span><span id=__span-27-49><a id=__codelineno-27-49 name=__codelineno-27-49 href=#__codelineno-27-49></a><span class=x>            $success = $this-&gt;clearServerOPcache($server);</span>
</span><span id=__span-27-50><a id=__codelineno-27-50 name=__codelineno-27-50 href=#__codelineno-27-50></a><span class=x>            $results[$server] = $success;</span>
</span><span id=__span-27-51><a id=__codelineno-27-51 name=__codelineno-27-51 href=#__codelineno-27-51></a>
</span><span id=__span-27-52><a id=__codelineno-27-52 name=__codelineno-27-52 href=#__codelineno-27-52></a><span class=x>            if ($success) {</span>
</span><span id=__span-27-53><a id=__codelineno-27-53 name=__codelineno-27-53 href=#__codelineno-27-53></a><span class=x>                $this-&gt;log(&quot;✓ OPcache cleared on {$server}&quot;);</span>
</span><span id=__span-27-54><a id=__codelineno-27-54 name=__codelineno-27-54 href=#__codelineno-27-54></a><span class=x>            } else {</span>
</span><span id=__span-27-55><a id=__codelineno-27-55 name=__codelineno-27-55 href=#__codelineno-27-55></a><span class=x>                $this-&gt;log(&quot;✗ Failed to clear OPcache on {$server}&quot;, &#39;error&#39;);</span>
</span><span id=__span-27-56><a id=__codelineno-27-56 name=__codelineno-27-56 href=#__codelineno-27-56></a><span class=x>            }</span>
</span><span id=__span-27-57><a id=__codelineno-27-57 name=__codelineno-27-57 href=#__codelineno-27-57></a><span class=x>        }</span>
</span><span id=__span-27-58><a id=__codelineno-27-58 name=__codelineno-27-58 href=#__codelineno-27-58></a>
</span><span id=__span-27-59><a id=__codelineno-27-59 name=__codelineno-27-59 href=#__codelineno-27-59></a><span class=x>        return !in_array(false, $results, true);</span>
</span><span id=__span-27-60><a id=__codelineno-27-60 name=__codelineno-27-60 href=#__codelineno-27-60></a><span class=x>    }</span>
</span><span id=__span-27-61><a id=__codelineno-27-61 name=__codelineno-27-61 href=#__codelineno-27-61></a>
</span><span id=__span-27-62><a id=__codelineno-27-62 name=__codelineno-27-62 href=#__codelineno-27-62></a><span class=x>    /**</span>
</span><span id=__span-27-63><a id=__codelineno-27-63 name=__codelineno-27-63 href=#__codelineno-27-63></a><span class=x>     * Warm up: прогреть cache после deploy</span>
</span><span id=__span-27-64><a id=__codelineno-27-64 name=__codelineno-27-64 href=#__codelineno-27-64></a><span class=x>     */</span>
</span><span id=__span-27-65><a id=__codelineno-27-65 name=__codelineno-27-65 href=#__codelineno-27-65></a><span class=x>    public function warmUp(): bool</span>
</span><span id=__span-27-66><a id=__codelineno-27-66 name=__codelineno-27-66 href=#__codelineno-27-66></a><span class=x>    {</span>
</span><span id=__span-27-67><a id=__codelineno-27-67 name=__codelineno-27-67 href=#__codelineno-27-67></a><span class=x>        $this-&gt;log(&#39;Warming up OPcache...&#39;);</span>
</span><span id=__span-27-68><a id=__codelineno-27-68 name=__codelineno-27-68 href=#__codelineno-27-68></a>
</span><span id=__span-27-69><a id=__codelineno-27-69 name=__codelineno-27-69 href=#__codelineno-27-69></a><span class=x>        $urls = $this-&gt;getWarmUpUrls();</span>
</span><span id=__span-27-70><a id=__codelineno-27-70 name=__codelineno-27-70 href=#__codelineno-27-70></a>
</span><span id=__span-27-71><a id=__codelineno-27-71 name=__codelineno-27-71 href=#__codelineno-27-71></a><span class=x>        foreach ($urls as $url) {</span>
</span><span id=__span-27-72><a id=__codelineno-27-72 name=__codelineno-27-72 href=#__codelineno-27-72></a><span class=x>            try {</span>
</span><span id=__span-27-73><a id=__codelineno-27-73 name=__codelineno-27-73 href=#__codelineno-27-73></a><span class=x>                Http::timeout(10)-&gt;get($url);</span>
</span><span id=__span-27-74><a id=__codelineno-27-74 name=__codelineno-27-74 href=#__codelineno-27-74></a><span class=x>                $this-&gt;log(&quot;✓ Warmed up: {$url}&quot;);</span>
</span><span id=__span-27-75><a id=__codelineno-27-75 name=__codelineno-27-75 href=#__codelineno-27-75></a><span class=x>            } catch (\Exception $e) {</span>
</span><span id=__span-27-76><a id=__codelineno-27-76 name=__codelineno-27-76 href=#__codelineno-27-76></a><span class=x>                $this-&gt;log(&quot;✗ Failed to warm up {$url}: {$e-&gt;getMessage()}&quot;, &#39;error&#39;);</span>
</span><span id=__span-27-77><a id=__codelineno-27-77 name=__codelineno-27-77 href=#__codelineno-27-77></a><span class=x>            }</span>
</span><span id=__span-27-78><a id=__codelineno-27-78 name=__codelineno-27-78 href=#__codelineno-27-78></a>
</span><span id=__span-27-79><a id=__codelineno-27-79 name=__codelineno-27-79 href=#__codelineno-27-79></a><span class=x>            usleep(100000); // 100ms delay between requests</span>
</span><span id=__span-27-80><a id=__codelineno-27-80 name=__codelineno-27-80 href=#__codelineno-27-80></a><span class=x>        }</span>
</span><span id=__span-27-81><a id=__codelineno-27-81 name=__codelineno-27-81 href=#__codelineno-27-81></a>
</span><span id=__span-27-82><a id=__codelineno-27-82 name=__codelineno-27-82 href=#__codelineno-27-82></a><span class=x>        return true;</span>
</span><span id=__span-27-83><a id=__codelineno-27-83 name=__codelineno-27-83 href=#__codelineno-27-83></a><span class=x>    }</span>
</span><span id=__span-27-84><a id=__codelineno-27-84 name=__codelineno-27-84 href=#__codelineno-27-84></a>
</span><span id=__span-27-85><a id=__codelineno-27-85 name=__codelineno-27-85 href=#__codelineno-27-85></a><span class=x>    /**</span>
</span><span id=__span-27-86><a id=__codelineno-27-86 name=__codelineno-27-86 href=#__codelineno-27-86></a><span class=x>     * Verify: проверить что deploy прошел успешно</span>
</span><span id=__span-27-87><a id=__codelineno-27-87 name=__codelineno-27-87 href=#__codelineno-27-87></a><span class=x>     */</span>
</span><span id=__span-27-88><a id=__codelineno-27-88 name=__codelineno-27-88 href=#__codelineno-27-88></a><span class=x>    public function verify(): array</span>
</span><span id=__span-27-89><a id=__codelineno-27-89 name=__codelineno-27-89 href=#__codelineno-27-89></a><span class=x>    {</span>
</span><span id=__span-27-90><a id=__codelineno-27-90 name=__codelineno-27-90 href=#__codelineno-27-90></a><span class=x>        $this-&gt;log(&#39;Verifying OPcache after deploy...&#39;);</span>
</span><span id=__span-27-91><a id=__codelineno-27-91 name=__codelineno-27-91 href=#__codelineno-27-91></a>
</span><span id=__span-27-92><a id=__codelineno-27-92 name=__codelineno-27-92 href=#__codelineno-27-92></a><span class=x>        sleep(5); // Подождать немного для накопления метрик</span>
</span><span id=__span-27-93><a id=__codelineno-27-93 name=__codelineno-27-93 href=#__codelineno-27-93></a>
</span><span id=__span-27-94><a id=__codelineno-27-94 name=__codelineno-27-94 href=#__codelineno-27-94></a><span class=x>        $issues = [];</span>
</span><span id=__span-27-95><a id=__codelineno-27-95 name=__codelineno-27-95 href=#__codelineno-27-95></a>
</span><span id=__span-27-96><a id=__codelineno-27-96 name=__codelineno-27-96 href=#__codelineno-27-96></a><span class=x>        foreach ($this-&gt;servers as $server) {</span>
</span><span id=__span-27-97><a id=__codelineno-27-97 name=__codelineno-27-97 href=#__codelineno-27-97></a><span class=x>            $status = $this-&gt;getServerOPcacheStatus($server);</span>
</span><span id=__span-27-98><a id=__codelineno-27-98 name=__codelineno-27-98 href=#__codelineno-27-98></a>
</span><span id=__span-27-99><a id=__codelineno-27-99 name=__codelineno-27-99 href=#__codelineno-27-99></a><span class=x>            // Проверить hit rate</span>
</span><span id=__span-27-100><a id=__codelineno-27-100 name=__codelineno-27-100 href=#__codelineno-27-100></a><span class=x>            if ($status[&#39;hit_rate&#39;] &lt; 80) {</span>
</span><span id=__span-27-101><a id=__codelineno-27-101 name=__codelineno-27-101 href=#__codelineno-27-101></a><span class=x>                $issues[] = &quot;Low hit rate on {$server}: {$status[&#39;hit_rate&#39;]}%&quot;;</span>
</span><span id=__span-27-102><a id=__codelineno-27-102 name=__codelineno-27-102 href=#__codelineno-27-102></a><span class=x>            }</span>
</span><span id=__span-27-103><a id=__codelineno-27-103 name=__codelineno-27-103 href=#__codelineno-27-103></a>
</span><span id=__span-27-104><a id=__codelineno-27-104 name=__codelineno-27-104 href=#__codelineno-27-104></a><span class=x>            // Проверить memory</span>
</span><span id=__span-27-105><a id=__codelineno-27-105 name=__codelineno-27-105 href=#__codelineno-27-105></a><span class=x>            if ($status[&#39;memory_usage&#39;] &gt; 95) {</span>
</span><span id=__span-27-106><a id=__codelineno-27-106 name=__codelineno-27-106 href=#__codelineno-27-106></a><span class=x>                $issues[] = &quot;High memory usage on {$server}: {$status[&#39;memory_usage&#39;]}%&quot;;</span>
</span><span id=__span-27-107><a id=__codelineno-27-107 name=__codelineno-27-107 href=#__codelineno-27-107></a><span class=x>            }</span>
</span><span id=__span-27-108><a id=__codelineno-27-108 name=__codelineno-27-108 href=#__codelineno-27-108></a>
</span><span id=__span-27-109><a id=__codelineno-27-109 name=__codelineno-27-109 href=#__codelineno-27-109></a><span class=x>            // Проверить restarts</span>
</span><span id=__span-27-110><a id=__codelineno-27-110 name=__codelineno-27-110 href=#__codelineno-27-110></a><span class=x>            if ($status[&#39;oom_restarts&#39;] &gt; 0) {</span>
</span><span id=__span-27-111><a id=__codelineno-27-111 name=__codelineno-27-111 href=#__codelineno-27-111></a><span class=x>                $issues[] = &quot;OOM restarts detected on {$server}&quot;;</span>
</span><span id=__span-27-112><a id=__codelineno-27-112 name=__codelineno-27-112 href=#__codelineno-27-112></a><span class=x>            }</span>
</span><span id=__span-27-113><a id=__codelineno-27-113 name=__codelineno-27-113 href=#__codelineno-27-113></a><span class=x>        }</span>
</span><span id=__span-27-114><a id=__codelineno-27-114 name=__codelineno-27-114 href=#__codelineno-27-114></a>
</span><span id=__span-27-115><a id=__codelineno-27-115 name=__codelineno-27-115 href=#__codelineno-27-115></a><span class=x>        if (empty($issues)) {</span>
</span><span id=__span-27-116><a id=__codelineno-27-116 name=__codelineno-27-116 href=#__codelineno-27-116></a><span class=x>            $this-&gt;log(&#39;✓ OPcache verification passed&#39;);</span>
</span><span id=__span-27-117><a id=__codelineno-27-117 name=__codelineno-27-117 href=#__codelineno-27-117></a><span class=x>        } else {</span>
</span><span id=__span-27-118><a id=__codelineno-27-118 name=__codelineno-27-118 href=#__codelineno-27-118></a><span class=x>            foreach ($issues as $issue) {</span>
</span><span id=__span-27-119><a id=__codelineno-27-119 name=__codelineno-27-119 href=#__codelineno-27-119></a><span class=x>                $this-&gt;log(&quot;✗ {$issue}&quot;, &#39;error&#39;);</span>
</span><span id=__span-27-120><a id=__codelineno-27-120 name=__codelineno-27-120 href=#__codelineno-27-120></a><span class=x>            }</span>
</span><span id=__span-27-121><a id=__codelineno-27-121 name=__codelineno-27-121 href=#__codelineno-27-121></a><span class=x>        }</span>
</span><span id=__span-27-122><a id=__codelineno-27-122 name=__codelineno-27-122 href=#__codelineno-27-122></a>
</span><span id=__span-27-123><a id=__codelineno-27-123 name=__codelineno-27-123 href=#__codelineno-27-123></a><span class=x>        return [</span>
</span><span id=__span-27-124><a id=__codelineno-27-124 name=__codelineno-27-124 href=#__codelineno-27-124></a><span class=x>            &#39;success&#39; =&gt; empty($issues),</span>
</span><span id=__span-27-125><a id=__codelineno-27-125 name=__codelineno-27-125 href=#__codelineno-27-125></a><span class=x>            &#39;issues&#39; =&gt; $issues,</span>
</span><span id=__span-27-126><a id=__codelineno-27-126 name=__codelineno-27-126 href=#__codelineno-27-126></a><span class=x>        ];</span>
</span><span id=__span-27-127><a id=__codelineno-27-127 name=__codelineno-27-127 href=#__codelineno-27-127></a><span class=x>    }</span>
</span><span id=__span-27-128><a id=__codelineno-27-128 name=__codelineno-27-128 href=#__codelineno-27-128></a>
</span><span id=__span-27-129><a id=__codelineno-27-129 name=__codelineno-27-129 href=#__codelineno-27-129></a><span class=x>    /**</span>
</span><span id=__span-27-130><a id=__codelineno-27-130 name=__codelineno-27-130 href=#__codelineno-27-130></a><span class=x>     * Rollback: восстановить предыдущее состояние</span>
</span><span id=__span-27-131><a id=__codelineno-27-131 name=__codelineno-27-131 href=#__codelineno-27-131></a><span class=x>     */</span>
</span><span id=__span-27-132><a id=__codelineno-27-132 name=__codelineno-27-132 href=#__codelineno-27-132></a><span class=x>    public function rollback(): bool</span>
</span><span id=__span-27-133><a id=__codelineno-27-133 name=__codelineno-27-133 href=#__codelineno-27-133></a><span class=x>    {</span>
</span><span id=__span-27-134><a id=__codelineno-27-134 name=__codelineno-27-134 href=#__codelineno-27-134></a><span class=x>        $this-&gt;log(&#39;Rolling back OPcache...&#39;);</span>
</span><span id=__span-27-135><a id=__codelineno-27-135 name=__codelineno-27-135 href=#__codelineno-27-135></a>
</span><span id=__span-27-136><a id=__codelineno-27-136 name=__codelineno-27-136 href=#__codelineno-27-136></a><span class=x>        // Очистить cache для перезагрузки старого кода</span>
</span><span id=__span-27-137><a id=__codelineno-27-137 name=__codelineno-27-137 href=#__codelineno-27-137></a><span class=x>        return $this-&gt;postDeploy();</span>
</span><span id=__span-27-138><a id=__codelineno-27-138 name=__codelineno-27-138 href=#__codelineno-27-138></a><span class=x>    }</span>
</span><span id=__span-27-139><a id=__codelineno-27-139 name=__codelineno-27-139 href=#__codelineno-27-139></a>
</span><span id=__span-27-140><a id=__codelineno-27-140 name=__codelineno-27-140 href=#__codelineno-27-140></a><span class=x>    private function getServerOPcacheStatus(string $server): array</span>
</span><span id=__span-27-141><a id=__codelineno-27-141 name=__codelineno-27-141 href=#__codelineno-27-141></a><span class=x>    {</span>
</span><span id=__span-27-142><a id=__codelineno-27-142 name=__codelineno-27-142 href=#__codelineno-27-142></a><span class=x>        try {</span>
</span><span id=__span-27-143><a id=__codelineno-27-143 name=__codelineno-27-143 href=#__codelineno-27-143></a><span class=x>            $response = Http::timeout(5)</span>
</span><span id=__span-27-144><a id=__codelineno-27-144 name=__codelineno-27-144 href=#__codelineno-27-144></a><span class=x>                -&gt;get(&quot;{$server}/api/opcache/status&quot;);</span>
</span><span id=__span-27-145><a id=__codelineno-27-145 name=__codelineno-27-145 href=#__codelineno-27-145></a>
</span><span id=__span-27-146><a id=__codelineno-27-146 name=__codelineno-27-146 href=#__codelineno-27-146></a><span class=x>            if ($response-&gt;successful()) {</span>
</span><span id=__span-27-147><a id=__codelineno-27-147 name=__codelineno-27-147 href=#__codelineno-27-147></a><span class=x>                $data = $response-&gt;json();</span>
</span><span id=__span-27-148><a id=__codelineno-27-148 name=__codelineno-27-148 href=#__codelineno-27-148></a>
</span><span id=__span-27-149><a id=__codelineno-27-149 name=__codelineno-27-149 href=#__codelineno-27-149></a><span class=x>                return [</span>
</span><span id=__span-27-150><a id=__codelineno-27-150 name=__codelineno-27-150 href=#__codelineno-27-150></a><span class=x>                    &#39;hit_rate&#39; =&gt; $data[&#39;statistics&#39;][&#39;hit_rate&#39;] ?? 0,</span>
</span><span id=__span-27-151><a id=__codelineno-27-151 name=__codelineno-27-151 href=#__codelineno-27-151></a><span class=x>                    &#39;memory_usage&#39; =&gt; $data[&#39;memory&#39;][&#39;usage_percent&#39;] ?? 0,</span>
</span><span id=__span-27-152><a id=__codelineno-27-152 name=__codelineno-27-152 href=#__codelineno-27-152></a><span class=x>                    &#39;oom_restarts&#39; =&gt; $data[&#39;statistics&#39;][&#39;oom_restarts&#39;] ?? 0,</span>
</span><span id=__span-27-153><a id=__codelineno-27-153 name=__codelineno-27-153 href=#__codelineno-27-153></a><span class=x>                ];</span>
</span><span id=__span-27-154><a id=__codelineno-27-154 name=__codelineno-27-154 href=#__codelineno-27-154></a><span class=x>            }</span>
</span><span id=__span-27-155><a id=__codelineno-27-155 name=__codelineno-27-155 href=#__codelineno-27-155></a><span class=x>        } catch (\Exception $e) {</span>
</span><span id=__span-27-156><a id=__codelineno-27-156 name=__codelineno-27-156 href=#__codelineno-27-156></a><span class=x>            $this-&gt;log(&quot;Failed to get OPcache status from {$server}: {$e-&gt;getMessage()}&quot;, &#39;error&#39;);</span>
</span><span id=__span-27-157><a id=__codelineno-27-157 name=__codelineno-27-157 href=#__codelineno-27-157></a><span class=x>        }</span>
</span><span id=__span-27-158><a id=__codelineno-27-158 name=__codelineno-27-158 href=#__codelineno-27-158></a>
</span><span id=__span-27-159><a id=__codelineno-27-159 name=__codelineno-27-159 href=#__codelineno-27-159></a><span class=x>        return [</span>
</span><span id=__span-27-160><a id=__codelineno-27-160 name=__codelineno-27-160 href=#__codelineno-27-160></a><span class=x>            &#39;hit_rate&#39; =&gt; 0,</span>
</span><span id=__span-27-161><a id=__codelineno-27-161 name=__codelineno-27-161 href=#__codelineno-27-161></a><span class=x>            &#39;memory_usage&#39; =&gt; 0,</span>
</span><span id=__span-27-162><a id=__codelineno-27-162 name=__codelineno-27-162 href=#__codelineno-27-162></a><span class=x>            &#39;oom_restarts&#39; =&gt; 0,</span>
</span><span id=__span-27-163><a id=__codelineno-27-163 name=__codelineno-27-163 href=#__codelineno-27-163></a><span class=x>        ];</span>
</span><span id=__span-27-164><a id=__codelineno-27-164 name=__codelineno-27-164 href=#__codelineno-27-164></a><span class=x>    }</span>
</span><span id=__span-27-165><a id=__codelineno-27-165 name=__codelineno-27-165 href=#__codelineno-27-165></a>
</span><span id=__span-27-166><a id=__codelineno-27-166 name=__codelineno-27-166 href=#__codelineno-27-166></a><span class=x>    private function clearServerOPcache(string $server): bool</span>
</span><span id=__span-27-167><a id=__codelineno-27-167 name=__codelineno-27-167 href=#__codelineno-27-167></a><span class=x>    {</span>
</span><span id=__span-27-168><a id=__codelineno-27-168 name=__codelineno-27-168 href=#__codelineno-27-168></a><span class=x>        try {</span>
</span><span id=__span-27-169><a id=__codelineno-27-169 name=__codelineno-27-169 href=#__codelineno-27-169></a><span class=x>            $response = Http::timeout(5)</span>
</span><span id=__span-27-170><a id=__codelineno-27-170 name=__codelineno-27-170 href=#__codelineno-27-170></a><span class=x>                -&gt;post(&quot;{$server}/api/opcache/clear&quot;);</span>
</span><span id=__span-27-171><a id=__codelineno-27-171 name=__codelineno-27-171 href=#__codelineno-27-171></a>
</span><span id=__span-27-172><a id=__codelineno-27-172 name=__codelineno-27-172 href=#__codelineno-27-172></a><span class=x>            return $response-&gt;successful();</span>
</span><span id=__span-27-173><a id=__codelineno-27-173 name=__codelineno-27-173 href=#__codelineno-27-173></a><span class=x>        } catch (\Exception $e) {</span>
</span><span id=__span-27-174><a id=__codelineno-27-174 name=__codelineno-27-174 href=#__codelineno-27-174></a><span class=x>            $this-&gt;log(&quot;Failed to clear OPcache on {$server}: {$e-&gt;getMessage()}&quot;, &#39;error&#39;);</span>
</span><span id=__span-27-175><a id=__codelineno-27-175 name=__codelineno-27-175 href=#__codelineno-27-175></a><span class=x>            return false;</span>
</span><span id=__span-27-176><a id=__codelineno-27-176 name=__codelineno-27-176 href=#__codelineno-27-176></a><span class=x>        }</span>
</span><span id=__span-27-177><a id=__codelineno-27-177 name=__codelineno-27-177 href=#__codelineno-27-177></a><span class=x>    }</span>
</span><span id=__span-27-178><a id=__codelineno-27-178 name=__codelineno-27-178 href=#__codelineno-27-178></a>
</span><span id=__span-27-179><a id=__codelineno-27-179 name=__codelineno-27-179 href=#__codelineno-27-179></a><span class=x>    private function getWarmUpUrls(): array</span>
</span><span id=__span-27-180><a id=__codelineno-27-180 name=__codelineno-27-180 href=#__codelineno-27-180></a><span class=x>    {</span>
</span><span id=__span-27-181><a id=__codelineno-27-181 name=__codelineno-27-181 href=#__codelineno-27-181></a><span class=x>        return [</span>
</span><span id=__span-27-182><a id=__codelineno-27-182 name=__codelineno-27-182 href=#__codelineno-27-182></a><span class=x>            $this-&gt;appUrl . &#39;/&#39;,</span>
</span><span id=__span-27-183><a id=__codelineno-27-183 name=__codelineno-27-183 href=#__codelineno-27-183></a><span class=x>            $this-&gt;appUrl . &#39;/api/health&#39;,</span>
</span><span id=__span-27-184><a id=__codelineno-27-184 name=__codelineno-27-184 href=#__codelineno-27-184></a><span class=x>            $this-&gt;appUrl . &#39;/blog&#39;,</span>
</span><span id=__span-27-185><a id=__codelineno-27-185 name=__codelineno-27-185 href=#__codelineno-27-185></a><span class=x>            // Добавить другие важные URLs</span>
</span><span id=__span-27-186><a id=__codelineno-27-186 name=__codelineno-27-186 href=#__codelineno-27-186></a><span class=x>        ];</span>
</span><span id=__span-27-187><a id=__codelineno-27-187 name=__codelineno-27-187 href=#__codelineno-27-187></a><span class=x>    }</span>
</span><span id=__span-27-188><a id=__codelineno-27-188 name=__codelineno-27-188 href=#__codelineno-27-188></a>
</span><span id=__span-27-189><a id=__codelineno-27-189 name=__codelineno-27-189 href=#__codelineno-27-189></a><span class=x>    private function log(string $message, string $level = &#39;info&#39;): void</span>
</span><span id=__span-27-190><a id=__codelineno-27-190 name=__codelineno-27-190 href=#__codelineno-27-190></a><span class=x>    {</span>
</span><span id=__span-27-191><a id=__codelineno-27-191 name=__codelineno-27-191 href=#__codelineno-27-191></a><span class=x>        Log::channel(&#39;deploy&#39;)-&gt;{$level}(&quot;[OPcache Deploy] {$message}&quot;);</span>
</span><span id=__span-27-192><a id=__codelineno-27-192 name=__codelineno-27-192 href=#__codelineno-27-192></a><span class=x>    }</span>
</span><span id=__span-27-193><a id=__codelineno-27-193 name=__codelineno-27-193 href=#__codelineno-27-193></a><span class=x>}</span>
</span><span id=__span-27-194><a id=__codelineno-27-194 name=__codelineno-27-194 href=#__codelineno-27-194></a>
</span><span id=__span-27-195><a id=__codelineno-27-195 name=__codelineno-27-195 href=#__codelineno-27-195></a><span class=x>// Artisan Command для deploy</span>
</span><span id=__span-27-196><a id=__codelineno-27-196 name=__codelineno-27-196 href=#__codelineno-27-196></a><span class=x>namespace App\Console\Commands;</span>
</span><span id=__span-27-197><a id=__codelineno-27-197 name=__codelineno-27-197 href=#__codelineno-27-197></a>
</span><span id=__span-27-198><a id=__codelineno-27-198 name=__codelineno-27-198 href=#__codelineno-27-198></a><span class=x>use App\Services\DeployOPcacheManager;</span>
</span><span id=__span-27-199><a id=__codelineno-27-199 name=__codelineno-27-199 href=#__codelineno-27-199></a><span class=x>use Illuminate\Console\Command;</span>
</span><span id=__span-27-200><a id=__codelineno-27-200 name=__codelineno-27-200 href=#__codelineno-27-200></a>
</span><span id=__span-27-201><a id=__codelineno-27-201 name=__codelineno-27-201 href=#__codelineno-27-201></a><span class=x>class DeployCommand extends Command</span>
</span><span id=__span-27-202><a id=__codelineno-27-202 name=__codelineno-27-202 href=#__codelineno-27-202></a><span class=x>{</span>
</span><span id=__span-27-203><a id=__codelineno-27-203 name=__codelineno-27-203 href=#__codelineno-27-203></a><span class=x>    protected $signature = &#39;deploy {--skip-opcache : Skip OPcache management}&#39;;</span>
</span><span id=__span-27-204><a id=__codelineno-27-204 name=__codelineno-27-204 href=#__codelineno-27-204></a><span class=x>    protected $description = &#39;Deploy application with OPcache management&#39;;</span>
</span><span id=__span-27-205><a id=__codelineno-27-205 name=__codelineno-27-205 href=#__codelineno-27-205></a>
</span><span id=__span-27-206><a id=__codelineno-27-206 name=__codelineno-27-206 href=#__codelineno-27-206></a><span class=x>    public function handle(DeployOPcacheManager $opcacheManager)</span>
</span><span id=__span-27-207><a id=__codelineno-27-207 name=__codelineno-27-207 href=#__codelineno-27-207></a><span class=x>    {</span>
</span><span id=__span-27-208><a id=__codelineno-27-208 name=__codelineno-27-208 href=#__codelineno-27-208></a><span class=x>        $this-&gt;info(&#39;Starting deployment...&#39;);</span>
</span><span id=__span-27-209><a id=__codelineno-27-209 name=__codelineno-27-209 href=#__codelineno-27-209></a>
</span><span id=__span-27-210><a id=__codelineno-27-210 name=__codelineno-27-210 href=#__codelineno-27-210></a><span class=x>        // Pre-deploy checks</span>
</span><span id=__span-27-211><a id=__codelineno-27-211 name=__codelineno-27-211 href=#__codelineno-27-211></a><span class=x>        if (!$this-&gt;option(&#39;skip-opcache&#39;)) {</span>
</span><span id=__span-27-212><a id=__codelineno-27-212 name=__codelineno-27-212 href=#__codelineno-27-212></a><span class=x>            $this-&gt;info(&#39;Running pre-deploy OPcache checks...&#39;);</span>
</span><span id=__span-27-213><a id=__codelineno-27-213 name=__codelineno-27-213 href=#__codelineno-27-213></a><span class=x>            $opcacheManager-&gt;preDeploy();</span>
</span><span id=__span-27-214><a id=__codelineno-27-214 name=__codelineno-27-214 href=#__codelineno-27-214></a><span class=x>        }</span>
</span><span id=__span-27-215><a id=__codelineno-27-215 name=__codelineno-27-215 href=#__codelineno-27-215></a>
</span><span id=__span-27-216><a id=__codelineno-27-216 name=__codelineno-27-216 href=#__codelineno-27-216></a><span class=x>        // Deploy code (git pull, composer install, etc.)</span>
</span><span id=__span-27-217><a id=__codelineno-27-217 name=__codelineno-27-217 href=#__codelineno-27-217></a><span class=x>        $this-&gt;info(&#39;Deploying code...&#39;);</span>
</span><span id=__span-27-218><a id=__codelineno-27-218 name=__codelineno-27-218 href=#__codelineno-27-218></a><span class=x>        $this-&gt;call(&#39;down&#39;);</span>
</span><span id=__span-27-219><a id=__codelineno-27-219 name=__codelineno-27-219 href=#__codelineno-27-219></a>
</span><span id=__span-27-220><a id=__codelineno-27-220 name=__codelineno-27-220 href=#__codelineno-27-220></a><span class=x>        exec(&#39;git pull origin main&#39;);</span>
</span><span id=__span-27-221><a id=__codelineno-27-221 name=__codelineno-27-221 href=#__codelineno-27-221></a><span class=x>        exec(&#39;composer install --no-dev --optimize-autoloader&#39;);</span>
</span><span id=__span-27-222><a id=__codelineno-27-222 name=__codelineno-27-222 href=#__codelineno-27-222></a>
</span><span id=__span-27-223><a id=__codelineno-27-223 name=__codelineno-27-223 href=#__codelineno-27-223></a><span class=x>        $this-&gt;call(&#39;migrate&#39;, [&#39;--force&#39; =&gt; true]);</span>
</span><span id=__span-27-224><a id=__codelineno-27-224 name=__codelineno-27-224 href=#__codelineno-27-224></a><span class=x>        $this-&gt;call(&#39;config:cache&#39;);</span>
</span><span id=__span-27-225><a id=__codelineno-27-225 name=__codelineno-27-225 href=#__codelineno-27-225></a><span class=x>        $this-&gt;call(&#39;route:cache&#39;);</span>
</span><span id=__span-27-226><a id=__codelineno-27-226 name=__codelineno-27-226 href=#__codelineno-27-226></a><span class=x>        $this-&gt;call(&#39;view:cache&#39;);</span>
</span><span id=__span-27-227><a id=__codelineno-27-227 name=__codelineno-27-227 href=#__codelineno-27-227></a>
</span><span id=__span-27-228><a id=__codelineno-27-228 name=__codelineno-27-228 href=#__codelineno-27-228></a><span class=x>        // Post-deploy OPcache management</span>
</span><span id=__span-27-229><a id=__codelineno-27-229 name=__codelineno-27-229 href=#__codelineno-27-229></a><span class=x>        if (!$this-&gt;option(&#39;skip-opcache&#39;)) {</span>
</span><span id=__span-27-230><a id=__codelineno-27-230 name=__codelineno-27-230 href=#__codelineno-27-230></a><span class=x>            $this-&gt;info(&#39;Clearing OPcache...&#39;);</span>
</span><span id=__span-27-231><a id=__codelineno-27-231 name=__codelineno-27-231 href=#__codelineno-27-231></a><span class=x>            if (!$opcacheManager-&gt;postDeploy()) {</span>
</span><span id=__span-27-232><a id=__codelineno-27-232 name=__codelineno-27-232 href=#__codelineno-27-232></a><span class=x>                $this-&gt;error(&#39;Failed to clear OPcache on some servers&#39;);</span>
</span><span id=__span-27-233><a id=__codelineno-27-233 name=__codelineno-27-233 href=#__codelineno-27-233></a>
</span><span id=__span-27-234><a id=__codelineno-27-234 name=__codelineno-27-234 href=#__codelineno-27-234></a><span class=x>                if ($this-&gt;confirm(&#39;Rollback?&#39;, true)) {</span>
</span><span id=__span-27-235><a id=__codelineno-27-235 name=__codelineno-27-235 href=#__codelineno-27-235></a><span class=x>                    $this-&gt;call(&#39;deploy:rollback&#39;);</span>
</span><span id=__span-27-236><a id=__codelineno-27-236 name=__codelineno-27-236 href=#__codelineno-27-236></a><span class=x>                    return 1;</span>
</span><span id=__span-27-237><a id=__codelineno-27-237 name=__codelineno-27-237 href=#__codelineno-27-237></a><span class=x>                }</span>
</span><span id=__span-27-238><a id=__codelineno-27-238 name=__codelineno-27-238 href=#__codelineno-27-238></a><span class=x>            }</span>
</span><span id=__span-27-239><a id=__codelineno-27-239 name=__codelineno-27-239 href=#__codelineno-27-239></a>
</span><span id=__span-27-240><a id=__codelineno-27-240 name=__codelineno-27-240 href=#__codelineno-27-240></a><span class=x>            $this-&gt;info(&#39;Warming up OPcache...&#39;);</span>
</span><span id=__span-27-241><a id=__codelineno-27-241 name=__codelineno-27-241 href=#__codelineno-27-241></a><span class=x>            $opcacheManager-&gt;warmUp();</span>
</span><span id=__span-27-242><a id=__codelineno-27-242 name=__codelineno-27-242 href=#__codelineno-27-242></a>
</span><span id=__span-27-243><a id=__codelineno-27-243 name=__codelineno-27-243 href=#__codelineno-27-243></a><span class=x>            $this-&gt;info(&#39;Verifying deployment...&#39;);</span>
</span><span id=__span-27-244><a id=__codelineno-27-244 name=__codelineno-27-244 href=#__codelineno-27-244></a><span class=x>            $result = $opcacheManager-&gt;verify();</span>
</span><span id=__span-27-245><a id=__codelineno-27-245 name=__codelineno-27-245 href=#__codelineno-27-245></a>
</span><span id=__span-27-246><a id=__codelineno-27-246 name=__codelineno-27-246 href=#__codelineno-27-246></a><span class=x>            if (!$result[&#39;success&#39;]) {</span>
</span><span id=__span-27-247><a id=__codelineno-27-247 name=__codelineno-27-247 href=#__codelineno-27-247></a><span class=x>                $this-&gt;error(&#39;Deployment verification failed:&#39;);</span>
</span><span id=__span-27-248><a id=__codelineno-27-248 name=__codelineno-27-248 href=#__codelineno-27-248></a><span class=x>                foreach ($result[&#39;issues&#39;] as $issue) {</span>
</span><span id=__span-27-249><a id=__codelineno-27-249 name=__codelineno-27-249 href=#__codelineno-27-249></a><span class=x>                    $this-&gt;line(&quot;  - {$issue}&quot;);</span>
</span><span id=__span-27-250><a id=__codelineno-27-250 name=__codelineno-27-250 href=#__codelineno-27-250></a><span class=x>                }</span>
</span><span id=__span-27-251><a id=__codelineno-27-251 name=__codelineno-27-251 href=#__codelineno-27-251></a>
</span><span id=__span-27-252><a id=__codelineno-27-252 name=__codelineno-27-252 href=#__codelineno-27-252></a><span class=x>                if ($this-&gt;confirm(&#39;Rollback?&#39;, true)) {</span>
</span><span id=__span-27-253><a id=__codelineno-27-253 name=__codelineno-27-253 href=#__codelineno-27-253></a><span class=x>                    $this-&gt;call(&#39;deploy:rollback&#39;);</span>
</span><span id=__span-27-254><a id=__codelineno-27-254 name=__codelineno-27-254 href=#__codelineno-27-254></a><span class=x>                    return 1;</span>
</span><span id=__span-27-255><a id=__codelineno-27-255 name=__codelineno-27-255 href=#__codelineno-27-255></a><span class=x>                }</span>
</span><span id=__span-27-256><a id=__codelineno-27-256 name=__codelineno-27-256 href=#__codelineno-27-256></a><span class=x>            }</span>
</span><span id=__span-27-257><a id=__codelineno-27-257 name=__codelineno-27-257 href=#__codelineno-27-257></a><span class=x>        }</span>
</span><span id=__span-27-258><a id=__codelineno-27-258 name=__codelineno-27-258 href=#__codelineno-27-258></a>
</span><span id=__span-27-259><a id=__codelineno-27-259 name=__codelineno-27-259 href=#__codelineno-27-259></a><span class=x>        $this-&gt;call(&#39;up&#39;);</span>
</span><span id=__span-27-260><a id=__codelineno-27-260 name=__codelineno-27-260 href=#__codelineno-27-260></a><span class=x>        $this-&gt;info(&#39;Deployment completed successfully!&#39;);</span>
</span><span id=__span-27-261><a id=__codelineno-27-261 name=__codelineno-27-261 href=#__codelineno-27-261></a>
</span><span id=__span-27-262><a id=__codelineno-27-262 name=__codelineno-27-262 href=#__codelineno-27-262></a><span class=x>        return 0;</span>
</span><span id=__span-27-263><a id=__codelineno-27-263 name=__codelineno-27-263 href=#__codelineno-27-263></a><span class=x>    }</span>
</span><span id=__span-27-264><a id=__codelineno-27-264 name=__codelineno-27-264 href=#__codelineno-27-264></a><span class=x>}</span>
</span><span id=__span-27-265><a id=__codelineno-27-265 name=__codelineno-27-265 href=#__codelineno-27-265></a>
</span><span id=__span-27-266><a id=__codelineno-27-266 name=__codelineno-27-266 href=#__codelineno-27-266></a><span class=x>// Bash deploy script</span>
</span><span id=__span-27-267><a id=__codelineno-27-267 name=__codelineno-27-267 href=#__codelineno-27-267></a><span class=x>/*</span>
</span><span id=__span-27-268><a id=__codelineno-27-268 name=__codelineno-27-268 href=#__codelineno-27-268></a><span class=x>#!/bin/bash</span>
</span><span id=__span-27-269><a id=__codelineno-27-269 name=__codelineno-27-269 href=#__codelineno-27-269></a>
</span><span id=__span-27-270><a id=__codelineno-27-270 name=__codelineno-27-270 href=#__codelineno-27-270></a><span class=x># deploy.sh</span>
</span><span id=__span-27-271><a id=__codelineno-27-271 name=__codelineno-27-271 href=#__codelineno-27-271></a>
</span><span id=__span-27-272><a id=__codelineno-27-272 name=__codelineno-27-272 href=#__codelineno-27-272></a><span class=x>set -e</span>
</span><span id=__span-27-273><a id=__codelineno-27-273 name=__codelineno-27-273 href=#__codelineno-27-273></a>
</span><span id=__span-27-274><a id=__codelineno-27-274 name=__codelineno-27-274 href=#__codelineno-27-274></a><span class=x>echo &quot;Starting deployment...&quot;</span>
</span><span id=__span-27-275><a id=__codelineno-27-275 name=__codelineno-27-275 href=#__codelineno-27-275></a>
</span><span id=__span-27-276><a id=__codelineno-27-276 name=__codelineno-27-276 href=#__codelineno-27-276></a><span class=x># Pre-deploy</span>
</span><span id=__span-27-277><a id=__codelineno-27-277 name=__codelineno-27-277 href=#__codelineno-27-277></a><span class=x>php artisan deploy:pre-check</span>
</span><span id=__span-27-278><a id=__codelineno-27-278 name=__codelineno-27-278 href=#__codelineno-27-278></a>
</span><span id=__span-27-279><a id=__codelineno-27-279 name=__codelineno-27-279 href=#__codelineno-27-279></a><span class=x># Pull code</span>
</span><span id=__span-27-280><a id=__codelineno-27-280 name=__codelineno-27-280 href=#__codelineno-27-280></a><span class=x>git pull origin main</span>
</span><span id=__span-27-281><a id=__codelineno-27-281 name=__codelineno-27-281 href=#__codelineno-27-281></a>
</span><span id=__span-27-282><a id=__codelineno-27-282 name=__codelineno-27-282 href=#__codelineno-27-282></a><span class=x># Install dependencies</span>
</span><span id=__span-27-283><a id=__codelineno-27-283 name=__codelineno-27-283 href=#__codelineno-27-283></a><span class=x>composer install --no-dev --optimize-autoloader</span>
</span><span id=__span-27-284><a id=__codelineno-27-284 name=__codelineno-27-284 href=#__codelineno-27-284></a>
</span><span id=__span-27-285><a id=__codelineno-27-285 name=__codelineno-27-285 href=#__codelineno-27-285></a><span class=x># Laravel optimizations</span>
</span><span id=__span-27-286><a id=__codelineno-27-286 name=__codelineno-27-286 href=#__codelineno-27-286></a><span class=x>php artisan config:cache</span>
</span><span id=__span-27-287><a id=__codelineno-27-287 name=__codelineno-27-287 href=#__codelineno-27-287></a><span class=x>php artisan route:cache</span>
</span><span id=__span-27-288><a id=__codelineno-27-288 name=__codelineno-27-288 href=#__codelineno-27-288></a><span class=x>php artisan view:cache</span>
</span><span id=__span-27-289><a id=__codelineno-27-289 name=__codelineno-27-289 href=#__codelineno-27-289></a>
</span><span id=__span-27-290><a id=__codelineno-27-290 name=__codelineno-27-290 href=#__codelineno-27-290></a><span class=x># Clear OPcache</span>
</span><span id=__span-27-291><a id=__codelineno-27-291 name=__codelineno-27-291 href=#__codelineno-27-291></a><span class=x>php artisan opcache:clear</span>
</span><span id=__span-27-292><a id=__codelineno-27-292 name=__codelineno-27-292 href=#__codelineno-27-292></a>
</span><span id=__span-27-293><a id=__codelineno-27-293 name=__codelineno-27-293 href=#__codelineno-27-293></a><span class=x># Reload PHP-FPM</span>
</span><span id=__span-27-294><a id=__codelineno-27-294 name=__codelineno-27-294 href=#__codelineno-27-294></a><span class=x>sudo systemctl reload php8.2-fpm</span>
</span><span id=__span-27-295><a id=__codelineno-27-295 name=__codelineno-27-295 href=#__codelineno-27-295></a>
</span><span id=__span-27-296><a id=__codelineno-27-296 name=__codelineno-27-296 href=#__codelineno-27-296></a><span class=x># Warm up</span>
</span><span id=__span-27-297><a id=__codelineno-27-297 name=__codelineno-27-297 href=#__codelineno-27-297></a><span class=x>php artisan cache:warm</span>
</span><span id=__span-27-298><a id=__codelineno-27-298 name=__codelineno-27-298 href=#__codelineno-27-298></a><span class=x>php artisan opcache:warm</span>
</span><span id=__span-27-299><a id=__codelineno-27-299 name=__codelineno-27-299 href=#__codelineno-27-299></a>
</span><span id=__span-27-300><a id=__codelineno-27-300 name=__codelineno-27-300 href=#__codelineno-27-300></a><span class=x># Verify</span>
</span><span id=__span-27-301><a id=__codelineno-27-301 name=__codelineno-27-301 href=#__codelineno-27-301></a><span class=x>php artisan deploy:verify</span>
</span><span id=__span-27-302><a id=__codelineno-27-302 name=__codelineno-27-302 href=#__codelineno-27-302></a>
</span><span id=__span-27-303><a id=__codelineno-27-303 name=__codelineno-27-303 href=#__codelineno-27-303></a><span class=x>echo &quot;Deployment completed!&quot;</span>
</span><span id=__span-27-304><a id=__codelineno-27-304 name=__codelineno-27-304 href=#__codelineno-27-304></a><span class=x>*/</span>
</span></code></pre></div> </details> <hr> <p><em>Часть <a href=/ >PHP/Laravel Interview Handbook</a> | Сделано с ❤️ командой <a href=https://codemate.team>CodeMate</a></em></p> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Была ли эта страница полезна? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="Да, полезна" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="Можно лучше" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Спасибо за отзыв! </div> <div data-md-value=0 hidden> Спасибо! Помогите нам улучшить страницу, создав issue на GitHub. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> К началу </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Сделано с ❤️ командой <a href=https://codemate.team target=_blank>CodeMate</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/codemateteam/php-handbook target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>